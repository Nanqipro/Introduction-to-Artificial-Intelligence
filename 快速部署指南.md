# ğŸš€ ä»£ç å®‰å…¨ä¿®å¤ - å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

- [ ] å·²é˜…è¯»ã€Šä»£ç å®‰å…¨ä¿®å¤æ€»ç»“.mdã€‹
- [ ] å·²å¤‡ä»½å½“å‰è¿è¡Œçš„ä»£ç å’Œæ•°æ®åº“
- [ ] å·²å‡†å¤‡å¥½æ•°æ®åº“å¯†ç å’Œé‚®ç®±å¯†ç 
- [ ] å·²ç¡®è®¤æœåŠ¡å™¨è¿æ¥æ­£å¸¸

---

## âš¡ å¿«é€Ÿéƒ¨ç½²ï¼ˆ3æ­¥å®Œæˆï¼‰

### æ­¥éª¤1: è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆå¿…é¡»ï¼ï¼‰

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤
# å°†ä¸‹é¢çš„å¯†ç æ›¿æ¢ä¸ºä½ çš„å®é™…å¯†ç 

export DB_USERNAME=root
export DB_PASSWORD=your_actual_db_password
export MAIL_USERNAME=your_email@qq.com
export MAIL_PASSWORD=your_mail_app_password

# éªŒè¯ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®æˆåŠŸ
echo $DB_PASSWORD
```

### æ­¥éª¤2: é‡æ–°ç¼–è¯‘å’Œéƒ¨ç½²åç«¯

```bash
# è¿›å…¥æœåŠ¡å™¨ç›®å½•
cd /home/nanqipro01/gitlocal/Introduction-to-Artificial-Intelligence/server

# ç¼–è¯‘é¡¹ç›®
./mvnw clean package -DskipTests

# åœæ­¢å½“å‰è¿è¡Œçš„æœåŠ¡ï¼ˆå¦‚æœæœ‰ï¼‰
# æ–¹æ³•1: å¦‚æœä½¿ç”¨systemd
sudo systemctl stop ai-platform-server

# æ–¹æ³•2: å¦‚æœæ˜¯ç›´æ¥è¿è¡Œçš„Javaè¿›ç¨‹
# pkill -f "server-0.0.1-SNAPSHOT.jar"

# å¯åŠ¨æœåŠ¡ï¼ˆä½¿ç”¨ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼‰
nohup java -jar target/server-0.0.1-SNAPSHOT.jar \
  --spring.profiles.active=prod \
  > server.log 2>&1 &

# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
tail -f server.log
```

### æ­¥éª¤3: é‡æ–°éƒ¨ç½²å‰ç«¯

```bash
# è¿›å…¥å®¢æˆ·ç«¯ç›®å½•
cd /home/nanqipro01/gitlocal/Introduction-to-Artificial-Intelligence/client

# é‡æ–°æ„å»ºï¼ˆå¦‚æœnpmä¾èµ–å·²å®‰è£…ï¼Œå¯è·³è¿‡npm installï¼‰
npm run build

# å¤‡ä»½æ—§ç‰ˆæœ¬
sudo cp -r /var/www/html /var/www/html.backup.$(date +%Y%m%d)

# éƒ¨ç½²æ–°ç‰ˆæœ¬
sudo cp -r dist/* /var/www/html/

# é‡å¯Nginx
sudo systemctl restart nginx
```

---

## âœ… éªŒè¯éƒ¨ç½²æ˜¯å¦æˆåŠŸ

### 1. æ£€æŸ¥åç«¯æœåŠ¡

```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
curl http://localhost:8082/api/chapters

# æŸ¥çœ‹æ—¥å¿—
tail -n 50 server.log

# æ£€æŸ¥å®‰å…¨å“åº”å¤´
curl -I http://localhost:8082/api/chapters | grep -E "X-Frame|X-Content-Type|X-XSS"
```

**é¢„æœŸç»“æœ**ï¼š
```
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
```

### 2. æ£€æŸ¥å‰ç«¯æœåŠ¡

```bash
# è®¿é—®å‰ç«¯
curl -I http://222.204.4.108/

# æ£€æŸ¥å‰ç«¯æ–‡ä»¶
ls -la /var/www/html/
```

### 3. æµ‹è¯•å®‰å…¨åŠŸèƒ½

```bash
# 1. æµ‹è¯•TRACEæ–¹æ³•ï¼ˆåº”è¯¥è¿”å›405ï¼‰
curl -X TRACE http://222.204.4.108:8082/
# é¢„æœŸ: {"code": 405, "message": "HTTPæ–¹æ³•ä¸å…è®¸: TRACE"}

# 2. æµ‹è¯•TRACKæ–¹æ³•ï¼ˆåº”è¯¥è¿”å›405ï¼‰
curl -X TRACK http://222.204.4.108:8082/
# é¢„æœŸ: {"code": 405, "message": "HTTPæ–¹æ³•ä¸å…è®¸: TRACK"}

# 3. æ£€æŸ¥æ‰€æœ‰å®‰å…¨å“åº”å¤´
curl -I http://222.204.4.108:8082/api/chapters
# åº”è¯¥çœ‹åˆ°æ‰€æœ‰å®‰å…¨å“åº”å¤´
```

### 4. åœ¨çº¿å®‰å…¨æ£€æµ‹

è®¿é—®ä»¥ä¸‹ç½‘ç«™æ£€æŸ¥å®‰å…¨é…ç½®ï¼š
- https://securityheaders.com - è¾“å…¥ `http://222.204.4.108`
- https://observatory.mozilla.org - è¾“å…¥ `http://222.204.4.108`

**é¢„æœŸè¯„åˆ†**ï¼š
- SecurityHeaders: Bçº§æˆ–ä»¥ä¸Š
- Mozilla Observatory: C+çº§æˆ–ä»¥ä¸Š

---

## ğŸ”§ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1: å¯åŠ¨åæŠ¥æ•°æ®åº“è¿æ¥é”™è¯¯

**åŸå› **: ç¯å¢ƒå˜é‡æœªè®¾ç½®æˆ–MySQLæœªå¯ç”¨SSL

**è§£å†³æ–¹æ³•**:
```bash
# 1. æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $DB_PASSWORD

# 2. å¦‚æœMySQLæœªé…ç½®SSLï¼Œä¸´æ—¶ä½¿ç”¨å¼€å‘ç¯å¢ƒé…ç½®
java -jar target/server-0.0.1-SNAPSHOT.jar \
  --spring.profiles.active=dev

# 3. æˆ–è€…ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒé…ç½®ä¸­çš„SSLè®¾ç½®
# å°† useSSL=true æ”¹ä¸º useSSL=falseï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰
```

### é—®é¢˜2: æ–‡ä»¶ä¸Šä¼ å¤±è´¥

**åŸå› **: ä¸Šä¼ ç›®å½•æƒé™ä¸è¶³

**è§£å†³æ–¹æ³•**:
```bash
# åˆ›å»ºä¸Šä¼ ç›®å½•
sudo mkdir -p /var/www/ai-platform/uploads/avatars/

# è®¾ç½®æƒé™
sudo chown -R www-data:www-data /var/www/ai-platform/uploads/
sudo chmod -R 755 /var/www/ai-platform/uploads/
```

### é—®é¢˜3: CORSé”™è¯¯

**åŸå› **: å‰ç«¯è®¿é—®çš„åŸŸåä¸åœ¨ç™½åå•ä¸­

**è§£å†³æ–¹æ³•**:
åç«¯å·²æ”¹ä¸ºæ³¨å†Œå…¨å±€ `CorsFilter`ï¼ŒæŒ‰æ¥æºè‡ªåŠ¨å›æ˜¾å…è®¸åŸŸã€‚

1) å¼€å‘/æµ‹è¯•ï¼ˆæœ¬åœ°ï¼‰ï¼šå·²å…è®¸ `http://localhost:*` å’Œ `http://127.0.0.1:*`ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

2) ç”Ÿäº§ï¼šå°†æœåŠ¡å™¨åŸŸåç«¯å£åŠ å…¥ `allowedOriginPatterns`ï¼ˆ`CorsConfig.java`ï¼‰ï¼š
```java
config.setAllowedOriginPatterns(Arrays.asList(
    "http://localhost:*",
    "http://127.0.0.1:*",
    "http://222.204.4.108:*",
    "http://your-domain.com:*" // ä½ çš„ç”Ÿäº§åŸŸå
));
```

3) é¢„æ£€éªŒè¯ï¼ˆå¿…é¡»é€šè¿‡ï¼‰ï¼š
```bash
curl -i -X OPTIONS http://localhost:8082/api/user/updatePwd \
  -H 'Origin: http://localhost:5173' \
  -H 'Access-Control-Request-Method: PATCH' \
  -H 'Access-Control-Request-Headers: content-type, authorization'
```
é¢„æœŸè¿”å› 200ï¼Œå¹¶åŒ…å«ï¼š
- `Access-Control-Allow-Origin`
- `Access-Control-Allow-Methods`
- `Access-Control-Allow-Headers`
- `Access-Control-Allow-Credentials`

### é—®é¢˜4: é‚®ä»¶å‘é€å¤±è´¥

**åŸå› **: é‚®ä»¶ç¯å¢ƒå˜é‡æœªè®¾ç½®

**è§£å†³æ–¹æ³•**:
```bash
# è®¾ç½®é‚®ä»¶ç¯å¢ƒå˜é‡
export MAIL_USERNAME=your_email@qq.com
export MAIL_PASSWORD=your_qq_app_password

# é‡å¯æœåŠ¡
```

---

## ğŸ¯ éƒ¨ç½²åæ£€æŸ¥é¡¹

### å¿…é¡»æ£€æŸ¥ï¼ˆCriticalï¼‰

- [ ] åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œï¼ˆç«¯å£8082å¯è®¿é—®ï¼‰
- [ ] å‰ç«¯é¡µé¢å¯ä»¥æ­£å¸¸æ‰“å¼€
- [ ] ç”¨æˆ·ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] ç¯å¢ƒå˜é‡å·²æ­£ç¡®è®¾ç½®

### å®‰å…¨æ£€æŸ¥ï¼ˆImportantï¼‰

- [ ] HTTPå®‰å…¨å“åº”å¤´å·²ç”Ÿæ•ˆ
- [ ] TRACEæ–¹æ³•å·²è¢«ç¦ç”¨
- [ ] æ–‡ä»¶ä¸Šä¼ å®‰å…¨éªŒè¯ç”Ÿæ•ˆ
- [ ] CORSé…ç½®æ­£ç¡®
  - [ ] é¢„æ£€ OPTIONS è¿”å› 200 ä¸”å…è®¸å¤´/æ–¹æ³•/æ¥æº
  - [ ] èµ„æ–™æ›´æ–°ä¸æ”¹å¯†è·¨åŸŸä¸å†æç¤º â€œNetwork Errorâ€
- [ ] é”™è¯¯é¡µé¢ä¸æ³„éœ²è¯¦ç»†ä¿¡æ¯

### åŠŸèƒ½æ£€æŸ¥ï¼ˆOptionalï¼‰

- [ ] ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½
- [ ] å¤´åƒä¸Šä¼ åŠŸèƒ½
- [ ] é‚®ä»¶å‘é€åŠŸèƒ½
- [ ] å„ç« èŠ‚å†…å®¹è®¿é—®æ­£å¸¸
- [ ] é¢˜åº“åŠŸèƒ½æ­£å¸¸
 - [ ] ä¸ªäººä¸­å¿ƒï¼šä»…æ”¹èµ„æ–™ä¸è§¦å‘å¯†ç æ ¡éªŒï¼›æ”¹å¯†æˆåŠŸè‡ªåŠ¨é€€å‡ºç¼–è¾‘

---

## ğŸ“Š éƒ¨ç½²å®Œæˆåçš„å®‰å…¨æå‡

### ä»£ç å±‚é¢ï¼ˆå·²å®Œæˆï¼‰âœ…
- âœ… HTTPå®‰å…¨å“åº”å¤´ä¿æŠ¤
- âœ… æ–‡ä»¶ä¸Šä¼ å®‰å…¨éªŒè¯
- âœ… CORSé…ç½®åŠ å¼º
- âœ… å±é™©HTTPæ–¹æ³•ç¦ç”¨
- âœ… æ•æ„Ÿä¿¡æ¯ç¯å¢ƒå˜é‡åŒ–
- âœ… ç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®

### æœåŠ¡å™¨å±‚é¢ï¼ˆå¾…é…åˆã€Šå®‰å…¨æ¼æ´ä¿®å¤è®¡åˆ’.mdã€‹å®Œæˆï¼‰
- â³ Nginxå‡çº§ï¼ˆä¿®å¤5ä¸ªé«˜å±æ¼æ´ï¼‰
- â³ MySQLå‡çº§ï¼ˆä¿®å¤1ä¸ªä¸­å±æ¼æ´ï¼‰
- â³ SSHé…ç½®åŠ å›º
- â³ æœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯éšè—

### é¢„æœŸæ•ˆæœ
- **ä»£ç å®‰å…¨æ€§**: â¬†ï¸ æ˜¾è‘—æå‡
- **Webåº”ç”¨é˜²æŠ¤**: â¬†ï¸ ä»å¼±åˆ°å¼º
- **æ•´ä½“é£é™©**: â¬‡ï¸ 9.7/10 â†’ çº¦7.0/10
- **é…åˆæœåŠ¡å™¨ä¿®å¤å**: â¬‡ï¸ é¢„è®¡é™è‡³3.0/10ä»¥ä¸‹

---

## ğŸ”„ æŒä¹…åŒ–ç¯å¢ƒå˜é‡ï¼ˆé‡è¦ï¼ï¼‰

ä¸ºäº†é˜²æ­¢æœåŠ¡å™¨é‡å¯åç¯å¢ƒå˜é‡ä¸¢å¤±ï¼Œéœ€è¦å°†ç¯å¢ƒå˜é‡æ·»åŠ åˆ°é…ç½®æ–‡ä»¶ï¼š

### æ–¹æ³•1: æ·»åŠ åˆ°systemdæœåŠ¡ï¼ˆæ¨èï¼‰

åˆ›å»ºæ–‡ä»¶ `/etc/systemd/system/ai-platform-server.service`:
```ini
[Unit]
Description=AI Platform Server
After=network.target

[Service]
Type=simple
User=your_user
WorkingDirectory=/home/nanqipro01/gitlocal/Introduction-to-Artificial-Intelligence/server
Environment="DB_USERNAME=root"
Environment="DB_PASSWORD=your_password"
Environment="MAIL_USERNAME=your_email@qq.com"
Environment="MAIL_PASSWORD=your_mail_password"
ExecStart=/usr/bin/java -jar target/server-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod
Restart=always

[Install]
WantedBy=multi-user.target
```

ç„¶åå¯åŠ¨æœåŠ¡ï¼š
```bash
sudo systemctl daemon-reload
sudo systemctl enable ai-platform-server
sudo systemctl start ai-platform-server
sudo systemctl status ai-platform-server
```

### æ–¹æ³•2: æ·»åŠ åˆ° ~/.bashrc æˆ– ~/.profile

```bash
# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano ~/.bashrc

# æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆæ–‡ä»¶æœ«å°¾ï¼‰
export DB_USERNAME=root
export DB_PASSWORD=your_password
export MAIL_USERNAME=your_email@qq.com
export MAIL_PASSWORD=your_mail_password

# ä¿å­˜åé‡æ–°åŠ è½½
source ~/.bashrc
```

### æ–¹æ³•3: ä½¿ç”¨.envæ–‡ä»¶ï¼ˆéœ€è¦é¢å¤–é…ç½®ï¼‰

åˆ›å»º `/home/nanqipro01/gitlocal/Introduction-to-Artificial-Intelligence/server/.env`:
```
DB_USERNAME=root
DB_PASSWORD=your_password
MAIL_USERNAME=your_email@qq.com
MAIL_PASSWORD=your_mail_password
```

åœ¨å¯åŠ¨è„šæœ¬ä¸­åŠ è½½ï¼š
```bash
set -a
source .env
set +a
java -jar target/server-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod
```

---

## ğŸ“ é‡åˆ°é—®é¢˜ï¼Ÿ

å¦‚æœéƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**
   ```bash
   # åç«¯æ—¥å¿—
   tail -f /home/nanqipro01/gitlocal/Introduction-to-Artificial-Intelligence/server/server.log
   
   # Nginxæ—¥å¿—
   sudo tail -f /var/log/nginx/error.log
   ```

2. **æ£€æŸ¥ç«¯å£å ç”¨**
   ```bash
   sudo netstat -tlnp | grep 8082
   ```

3. **æ£€æŸ¥æœåŠ¡çŠ¶æ€**
   ```bash
   sudo systemctl status nginx
   sudo systemctl status ai-platform-server
   ```

4. **å›æ»šåˆ°ä¹‹å‰ç‰ˆæœ¬**
   ```bash
   # åœæ­¢æœåŠ¡
   sudo systemctl stop ai-platform-server
   
   # æ¢å¤å¤‡ä»½
   sudo cp -r /var/www/html.backup.YYYYMMDD/* /var/www/html/
   
   # ä½¿ç”¨æ—§ç‰ˆæœ¬jar
   # ...
   ```

---

## âœ… éƒ¨ç½²å®Œæˆç¡®è®¤

éƒ¨ç½²å®Œæˆåï¼Œè¯·ç¡®è®¤ï¼š

- [x] æ‰€æœ‰æœåŠ¡æ­£å¸¸è¿è¡Œ
- [x] ç¯å¢ƒå˜é‡å·²æŒä¹…åŒ–
- [x] å®‰å…¨åŠŸèƒ½å·²éªŒè¯ç”Ÿæ•ˆ
- [x] ç”¨æˆ·åŠŸèƒ½æ­£å¸¸
- [x] æ€§èƒ½æ— æ˜æ˜¾ä¸‹é™
- [x] æ—¥å¿—ä¸­æ— ä¸¥é‡é”™è¯¯

**æ­å–œï¼ä»£ç å±‚é¢çš„å®‰å…¨ä¿®å¤å·²å®Œæˆéƒ¨ç½²ï¼** ğŸ‰

æ¥ä¸‹æ¥è¯·æŒ‰ç…§ã€Šå®‰å…¨æ¼æ´ä¿®å¤è®¡åˆ’.mdã€‹å®ŒæˆæœåŠ¡å™¨å±‚é¢çš„ä¿®å¤ï¼ˆNginxå‡çº§ã€MySQLå‡çº§ç­‰ï¼‰ä»¥è¾¾åˆ°æœ€ä½³å®‰å…¨æ•ˆæœã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-30  
**é¢„è®¡éƒ¨ç½²æ—¶é—´**: 30-60åˆ†é’Ÿ

