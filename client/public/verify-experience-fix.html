<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»éªŒå€¼åŒæ­¥ä¿®å¤éªŒè¯å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #4CAF50;
        }

        .test-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .test-button {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .test-button.warning {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        }

        .test-button.danger {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
        }

        .result {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .result.success {
            border-color: #4CAF50;
            background-color: #f1f8e9;
        }

        .result.error {
            border-color: #f44336;
            background-color: #ffebee;
        }

        .result.warning {
            border-color: #ff9800;
            background-color: #fff3e0;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success { background-color: #4CAF50; }
        .status-error { background-color: #f44336; }
        .status-warning { background-color: #ff9800; }
        .status-info { background-color: #2196F3; }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .comparison-table th {
            background-color: #f5f5f5;
            font-weight: 600;
        }

        .comparison-table .changed {
            background-color: #e8f5e8;
            font-weight: bold;
        }

        .fix-status {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            text-align: center;
        }

        .fix-status h2 {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ ç»éªŒå€¼åŒæ­¥ä¿®å¤éªŒè¯</h1>
            <p>éªŒè¯UserMapper SQLä¿®å¤åçš„ç»éªŒå€¼åŒæ­¥åŠŸèƒ½</p>
        </div>

        <div class="content">
            <div class="fix-status">
                <h2>ğŸ› ï¸ ä¿®å¤å†…å®¹</h2>
                <p>å·²ä¿®å¤UserMapperä¸­çš„updateæ–¹æ³•SQLè¯­å¥ï¼Œæ·»åŠ äº†ç»éªŒå€¼ç›¸å…³å­—æ®µçš„æ›´æ–°</p>
                <p>ä¿®å¤å­—æ®µï¼šlevel, experience, total_score, completed_chapters, quiz_count, correct_answers</p>
            </div>

            <div class="test-section">
                <h3>ğŸ“Š 1. åŸºç¡€çŠ¶æ€æ£€æŸ¥</h3>
                <div class="button-group">
                    <button class="test-button" onclick="checkLoginStatus()">æ£€æŸ¥ç™»å½•çŠ¶æ€</button>
                    <button class="test-button" onclick="getCurrentData()">è·å–å½“å‰æ•°æ®</button>
                    <button class="test-button" onclick="resetTestData()">é‡ç½®æµ‹è¯•æ•°æ®</button>
                </div>
                <div id="status-result" class="result" style="display:none;"></div>
            </div>

            <div class="test-section">
                <h3>ğŸ§ª 2. ä¿®å¤éªŒè¯æµ‹è¯•</h3>
                <div class="button-group">
                    <button class="test-button warning" onclick="testExperienceSync()">å®Œæ•´åŒæ­¥æµ‹è¯•</button>
                    <button class="test-button" onclick="testQuizExperience()">æµ‹éªŒç»éªŒå€¼æµ‹è¯•</button>
                    <button class="test-button" onclick="testChapterExperience()">ç« èŠ‚ç»éªŒå€¼æµ‹è¯•</button>
                </div>
                <div id="test-result" class="result" style="display:none;"></div>
            </div>

            <div class="test-section">
                <h3>ğŸ”„ 3. äº‹ä»¶ç³»ç»ŸéªŒè¯</h3>
                <div class="button-group">
                    <button class="test-button" onclick="testEventSystem()">æµ‹è¯•äº‹ä»¶è§¦å‘</button>
                    <button class="test-button" onclick="testProfileRefresh()">æµ‹è¯•ä¸ªäººä¸­å¿ƒåˆ·æ–°</button>
                </div>
                <div id="event-result" class="result" style="display:none;"></div>
            </div>

            <div class="test-section">
                <h3>ğŸ“ˆ 4. æ•°æ®å¯¹æ¯”éªŒè¯</h3>
                <div class="button-group">
                    <button class="test-button" onclick="compareBeforeAfter()">å‰åæ•°æ®å¯¹æ¯”</button>
                    <button class="test-button danger" onclick="clearAllData()">æ¸…é™¤æµ‹è¯•æ•°æ®</button>
                </div>
                <div id="compare-result" class="result" style="display:none;"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8082';
        let testData = {
            before: null,
            after: null,
            events: []
        };

        // è·å–è®¤è¯å¤´
        function getAuthHeaders() {
            const token = localStorage.getItem('token');
            return {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            };
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
            element.style.display = 'block';
        }

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        async function checkLoginStatus() {
            let message = '=== ç™»å½•çŠ¶æ€æ£€æŸ¥ ===\n';
            
            const token = localStorage.getItem('token');
            if (!token) {
                message += 'âŒ æœªæ‰¾åˆ°ç™»å½•ä»¤ç‰Œ\n';
                showResult('status-result', message, 'error');
                return false;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/user/userInfo`, {
                    headers: getAuthHeaders()
                });
                
                const data = await response.json();
                
                if (data.code === 200) {
                    message += 'âœ… ç™»å½•çŠ¶æ€æ­£å¸¸\n';
                    message += `ç”¨æˆ·ID: ${data.data.id}\n`;
                    message += `ç”¨æˆ·å: ${data.data.username}\n`;
                    message += `è§’è‰²: ${data.data.role}\n`;
                    showResult('status-result', message, 'success');
                    return true;
                } else {
                    message += `âŒ ç™»å½•éªŒè¯å¤±è´¥: ${data.message}\n`;
                    showResult('status-result', message, 'error');
                    return false;
                }
            } catch (error) {
                message += `âŒ è¯·æ±‚å¤±è´¥: ${error.message}\n`;
                showResult('status-result', message, 'error');
                return false;
            }
        }

        // è·å–å½“å‰æ•°æ®
        async function getCurrentData() {
            if (!await checkLoginStatus()) return;
            
            let message = '=== å½“å‰ç”¨æˆ·æ•°æ® ===\n';
            
            try {
                // è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®
                const statsResponse = await fetch(`${API_BASE}/api/level/stats`, {
                    headers: getAuthHeaders()
                });
                
                const statsData = await statsResponse.json();
                
                if (statsData.code === 200) {
                    const stats = statsData.data;
                    message += `ç­‰çº§: ${stats.level}\n`;
                    message += `ç»éªŒå€¼: ${stats.experience}\n`;
                    message += `æ€»åˆ†: ${stats.totalScore}\n`;
                    message += `å®Œæˆç« èŠ‚: ${stats.completedChapters}\n`;
                    message += `æµ‹éªŒæ¬¡æ•°: ${stats.quizCount}\n`;
                    message += `æ­£ç¡®ç­”æ¡ˆ: ${stats.correctAnswers}\n`;
                    message += `å‡†ç¡®ç‡: ${stats.accuracy}%\n`;
                    
                    testData.before = { ...stats, timestamp: new Date().toISOString() };
                    showResult('status-result', message, 'success');
                } else {
                    message += `âŒ è·å–æ•°æ®å¤±è´¥: ${statsData.message}\n`;
                    showResult('status-result', message, 'error');
                }
            } catch (error) {
                message += `âŒ è¯·æ±‚å¤±è´¥: ${error.message}\n`;
                showResult('status-result', message, 'error');
            }
        }

        // å®Œæ•´åŒæ­¥æµ‹è¯•
        async function testExperienceSync() {
            let message = '=== å®Œæ•´ç»éªŒå€¼åŒæ­¥æµ‹è¯• ===\n';
            
            // è·å–æµ‹è¯•å‰æ•°æ®
            await getCurrentData();
            const beforeData = { ...testData.before };
            
            message += `\nğŸ“Š æµ‹è¯•å‰æ•°æ®:\n`;
            message += `- ç­‰çº§: ${beforeData.level}\n`;
            message += `- ç»éªŒå€¼: ${beforeData.experience}\n`;
            message += `- æ€»åˆ†: ${beforeData.totalScore}\n`;
            
            try {
                // æ·»åŠ ç»éªŒå€¼
                const requestData = {
                    experience: 50,
                    activityType: 'quiz_completion',
                    chapterId: 1,
                    score: 85
                };
                
                message += `\nğŸ¯ æ·»åŠ ç»éªŒå€¼: ${requestData.experience}\n`;
                message += `æ´»åŠ¨ç±»å‹: ${requestData.activityType}\n`;
                message += `å¾—åˆ†: ${requestData.score}\n`;
                
                const response = await fetch(`${API_BASE}/api/level/addExperience`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(requestData)
                });
                
                const responseData = await response.json();
                
                if (response.ok && responseData.code === 200) {
                    message += `\nâœ… APIè°ƒç”¨æˆåŠŸ\n`;
                    message += `è¿”å›æ•°æ®: ${JSON.stringify(responseData.data, null, 2)}\n`;
                    
                    // ç­‰å¾…ä¸€ä¸‹ï¼Œç„¶åè·å–æœ€æ–°æ•°æ®
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // é‡æ–°è·å–æ•°æ®éªŒè¯
                    const verifyResponse = await fetch(`${API_BASE}/api/level/stats`, {
                        headers: getAuthHeaders()
                    });
                    
                    const verifyData = await verifyResponse.json();
                    
                    if (verifyData.code === 200) {
                        const afterData = verifyData.data;
                        testData.after = { ...afterData, timestamp: new Date().toISOString() };
                        
                        message += `\nğŸ“ˆ éªŒè¯åæ•°æ®:\n`;
                        message += `- ç­‰çº§: ${afterData.level} (å˜åŒ–: ${afterData.level - beforeData.level})\n`;
                        message += `- ç»éªŒå€¼: ${afterData.experience} (å˜åŒ–: ${afterData.experience - beforeData.experience})\n`;
                        message += `- æ€»åˆ†: ${afterData.totalScore} (å˜åŒ–: ${afterData.totalScore - beforeData.totalScore})\n`;
                        message += `- æµ‹éªŒæ¬¡æ•°: ${afterData.quizCount} (å˜åŒ–: ${afterData.quizCount - beforeData.quizCount})\n`;
                        
                        // éªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®æ›´æ–°
                        const expDiff = afterData.experience - beforeData.experience;
                        const scoreDiff = afterData.totalScore - beforeData.totalScore;
                        const quizDiff = afterData.quizCount - beforeData.quizCount;
                        
                        if (expDiff === 50 && scoreDiff === 85 && quizDiff === 1) {
                            message += `\nğŸ‰ ä¿®å¤éªŒè¯æˆåŠŸï¼\n`;
                            message += `âœ… ç»éªŒå€¼æ­£ç¡®å¢åŠ : ${expDiff}\n`;
                            message += `âœ… æ€»åˆ†æ­£ç¡®å¢åŠ : ${scoreDiff}\n`;
                            message += `âœ… æµ‹éªŒæ¬¡æ•°æ­£ç¡®å¢åŠ : ${quizDiff}\n`;
                            message += `\nğŸ”§ UserMapper SQLä¿®å¤ç”Ÿæ•ˆï¼\n`;
                            showResult('test-result', message, 'success');
                        } else {
                            message += `\nâš ï¸ æ•°æ®æ›´æ–°å¼‚å¸¸:\n`;
                            message += `æœŸæœ›ç»éªŒå€¼å¢åŠ : 50, å®é™…: ${expDiff}\n`;
                            message += `æœŸæœ›æ€»åˆ†å¢åŠ : 85, å®é™…: ${scoreDiff}\n`;
                            message += `æœŸæœ›æµ‹éªŒæ¬¡æ•°å¢åŠ : 1, å®é™…: ${quizDiff}\n`;
                            showResult('test-result', message, 'warning');
                        }
                    } else {
                        message += `\nâŒ éªŒè¯æ•°æ®è·å–å¤±è´¥: ${verifyData.message}\n`;
                        showResult('test-result', message, 'error');
                    }
                } else {
                    message += `\nâŒ APIè°ƒç”¨å¤±è´¥: ${responseData.message}\n`;
                    showResult('test-result', message, 'error');
                }
            } catch (error) {
                message += `\nâŒ æµ‹è¯•å¤±è´¥: ${error.message}\n`;
                showResult('test-result', message, 'error');
            }
        }

        // æµ‹è¯•æµ‹éªŒç»éªŒå€¼
        async function testQuizExperience() {
            let message = '=== æµ‹éªŒç»éªŒå€¼æµ‹è¯• ===\n';
            
            try {
                const requestData = {
                    experience: 25,
                    activityType: 'quiz',
                    chapterId: 2,
                    score: 90
                };
                
                message += `æ·»åŠ æµ‹éªŒç»éªŒå€¼: ${requestData.experience}\n`;
                
                const response = await fetch(`${API_BASE}/api/level/addExperience`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.code === 200) {
                    message += `âœ… æµ‹éªŒç»éªŒå€¼æ·»åŠ æˆåŠŸ\n`;
                    message += `ç»“æœ: ${JSON.stringify(data.data, null, 2)}\n`;
                    showResult('test-result', message, 'success');
                } else {
                    message += `âŒ æµ‹éªŒç»éªŒå€¼æ·»åŠ å¤±è´¥: ${data.message}\n`;
                    showResult('test-result', message, 'error');
                }
            } catch (error) {
                message += `âŒ è¯·æ±‚å¤±è´¥: ${error.message}\n`;
                showResult('test-result', message, 'error');
            }
        }

        // æµ‹è¯•ç« èŠ‚ç»éªŒå€¼
        async function testChapterExperience() {
            let message = '=== ç« èŠ‚ç»éªŒå€¼æµ‹è¯• ===\n';
            
            try {
                const requestData = {
                    experience: 100,
                    activityType: 'chapter',
                    chapterId: 3,
                    score: 100
                };
                
                message += `æ·»åŠ ç« èŠ‚ç»éªŒå€¼: ${requestData.experience}\n`;
                
                const response = await fetch(`${API_BASE}/api/level/addExperience`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.code === 200) {
                    message += `âœ… ç« èŠ‚ç»éªŒå€¼æ·»åŠ æˆåŠŸ\n`;
                    message += `ç»“æœ: ${JSON.stringify(data.data, null, 2)}\n`;
                    showResult('test-result', message, 'success');
                } else {
                    message += `âŒ ç« èŠ‚ç»éªŒå€¼æ·»åŠ å¤±è´¥: ${data.message}\n`;
                    showResult('test-result', message, 'error');
                }
            } catch (error) {
                message += `âŒ è¯·æ±‚å¤±è´¥: ${error.message}\n`;
                showResult('test-result', message, 'error');
            }
        }

        // æµ‹è¯•äº‹ä»¶ç³»ç»Ÿ
        function testEventSystem() {
            let message = '=== äº‹ä»¶ç³»ç»Ÿæµ‹è¯• ===\n';
            
            // ç›‘å¬ç»éªŒå€¼æ›´æ–°äº‹ä»¶
            const eventListener = (event) => {
                message += `\nğŸ¯ æ”¶åˆ°experienceUpdatedäº‹ä»¶:\n`;
                message += `äº‹ä»¶æ•°æ®: ${JSON.stringify(event.detail, null, 2)}\n`;
                testData.events.push({
                    type: 'experienceUpdated',
                    data: event.detail,
                    timestamp: new Date().toISOString()
                });
                showResult('event-result', message, 'success');
            };
            
            window.addEventListener('experienceUpdated', eventListener);
            
            // è§¦å‘æµ‹è¯•äº‹ä»¶
            const testEventData = {
                experienceGained: 30,
                newExperience: 130,
                newLevel: 2,
                leveledUp: true
            };
            
            message += `è§¦å‘æµ‹è¯•äº‹ä»¶...\n`;
            message += `äº‹ä»¶æ•°æ®: ${JSON.stringify(testEventData, null, 2)}\n`;
            
            window.dispatchEvent(new CustomEvent('experienceUpdated', {
                detail: testEventData
            }));
            
            // 5ç§’åç§»é™¤ç›‘å¬å™¨
            setTimeout(() => {
                window.removeEventListener('experienceUpdated', eventListener);
                message += `\nâœ… äº‹ä»¶ç›‘å¬å™¨å·²ç§»é™¤\n`;
                showResult('event-result', message, 'success');
            }, 5000);
        }

        // æµ‹è¯•ä¸ªäººä¸­å¿ƒåˆ·æ–°
        function testProfileRefresh() {
            let message = '=== ä¸ªäººä¸­å¿ƒåˆ·æ–°æµ‹è¯• ===\n';
            
            // æ¨¡æ‹Ÿä¸ªäººä¸­å¿ƒçš„äº‹ä»¶ç›‘å¬
            const profileListener = (event) => {
                message += `\nğŸ“± ä¸ªäººä¸­å¿ƒæ”¶åˆ°äº‹ä»¶:\n`;
                message += `äº‹ä»¶è¯¦æƒ…: ${JSON.stringify(event.detail, null, 2)}\n`;
                message += `\nğŸ”„ æ¨¡æ‹Ÿä¸ªäººä¸­å¿ƒæ•°æ®åˆ·æ–°...\n`;
                
                // æ¨¡æ‹Ÿå»¶è¿Ÿåˆ·æ–°
                setTimeout(() => {
                    message += `âœ… ä¸ªäººä¸­å¿ƒæ•°æ®åˆ·æ–°å®Œæˆ\n`;
                    showResult('event-result', message, 'success');
                }, 500);
            };
            
            window.addEventListener('experienceUpdated', profileListener);
            
            message += `å¼€å§‹ä¸ªäººä¸­å¿ƒåˆ·æ–°æµ‹è¯•...\n`;
            
            // è§¦å‘ç»éªŒå€¼æ›´æ–°äº‹ä»¶
            window.dispatchEvent(new CustomEvent('experienceUpdated', {
                detail: {
                    experienceGained: 40,
                    newExperience: 170,
                    newLevel: 2,
                    leveledUp: false
                }
            }));
            
            // 3ç§’åç§»é™¤ç›‘å¬å™¨
            setTimeout(() => {
                window.removeEventListener('experienceUpdated', profileListener);
            }, 3000);
        }

        // å‰åæ•°æ®å¯¹æ¯”
        function compareBeforeAfter() {
            let message = '=== æ•°æ®å¯¹æ¯”åˆ†æ ===\n';
            
            if (!testData.before || !testData.after) {
                message += 'âŒ ç¼ºå°‘å¯¹æ¯”æ•°æ®ï¼Œè¯·å…ˆè¿è¡Œå®Œæ•´åŒæ­¥æµ‹è¯•\n';
                showResult('compare-result', message, 'warning');
                return;
            }
            
            const before = testData.before;
            const after = testData.after;
            
            message += `æµ‹è¯•æ—¶é—´èŒƒå›´: ${before.timestamp} åˆ° ${after.timestamp}\n\n`;
            
            // åˆ›å»ºå¯¹æ¯”è¡¨æ ¼
            const fields = ['level', 'experience', 'totalScore', 'completedChapters', 'quizCount', 'correctAnswers'];
            const fieldNames = {
                level: 'ç­‰çº§',
                experience: 'ç»éªŒå€¼',
                totalScore: 'æ€»åˆ†',
                completedChapters: 'å®Œæˆç« èŠ‚',
                quizCount: 'æµ‹éªŒæ¬¡æ•°',
                correctAnswers: 'æ­£ç¡®ç­”æ¡ˆ'
            };
            
            message += 'å­—æ®µ\t\tæµ‹è¯•å‰\tæµ‹è¯•å\tå˜åŒ–\n';
            message += '----------------------------------------\n';
            
            let hasChanges = false;
            fields.forEach(field => {
                const beforeVal = before[field] || 0;
                const afterVal = after[field] || 0;
                const change = afterVal - beforeVal;
                
                if (change !== 0) {
                    hasChanges = true;
                }
                
                message += `${fieldNames[field]}\t\t${beforeVal}\t${afterVal}\t${change > 0 ? '+' : ''}${change}\n`;
            });
            
            message += '\n';
            
            if (hasChanges) {
                message += 'âœ… æ£€æµ‹åˆ°æ•°æ®å˜åŒ–ï¼Œä¿®å¤ç”Ÿæ•ˆï¼\n';
                message += '\nğŸ‰ UserMapper SQLä¿®å¤éªŒè¯æˆåŠŸï¼\n';
                message += 'ç»éªŒå€¼åŒæ­¥é—®é¢˜å·²è§£å†³ã€‚\n';
                showResult('compare-result', message, 'success');
            } else {
                message += 'âš ï¸ æœªæ£€æµ‹åˆ°æ•°æ®å˜åŒ–\n';
                message += 'è¯·æ£€æŸ¥æ˜¯å¦æ­£ç¡®æ‰§è¡Œäº†æµ‹è¯•æ­¥éª¤ã€‚\n';
                showResult('compare-result', message, 'warning');
            }
        }

        // é‡ç½®æµ‹è¯•æ•°æ®
        function resetTestData() {
            testData = {
                before: null,
                after: null,
                events: []
            };
            
            showResult('status-result', 'âœ… æµ‹è¯•æ•°æ®å·²é‡ç½®', 'success');
        }

        // æ¸…é™¤æ‰€æœ‰æ•°æ®
        function clearAllData() {
            resetTestData();
            
            // æ¸…é™¤æ‰€æœ‰ç»“æœæ˜¾ç¤º
            ['status-result', 'test-result', 'event-result', 'compare-result'].forEach(id => {
                const element = document.getElementById(id);
                element.style.display = 'none';
            });
            
            showResult('status-result', 'âœ… æ‰€æœ‰æ•°æ®å’Œæ˜¾ç¤ºå·²æ¸…é™¤', 'success');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥ç™»å½•çŠ¶æ€
        window.addEventListener('load', () => {
            setTimeout(checkLoginStatus, 500);
        });
    </script>
</body>
</html>