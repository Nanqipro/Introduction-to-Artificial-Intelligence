<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测验完成测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .step {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .step h3 {
            margin-top: 0;
            color: #333;
        }
        .code {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            margin: 10px 0;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧪 测验完成和经验值更新测试</h1>
        
        <div class="warning">
            <strong>⚠️ 重要提示：</strong>请确保您已经登录并且有有效的token！
        </div>

        <div class="step">
            <h3>步骤1: 检查登录状态</h3>
            <p>在浏览器控制台运行以下代码：</p>
            <div class="code">
const token = localStorage.getItem('token');
console.log('当前token:', token ? '已登录' : '未登录');
if (token) {
    try {
        const payload = JSON.parse(atob(token.split('.')[1]));
        console.log('用户ID:', payload.id);
        console.log('用户名:', payload.username);
        console.log('token过期时间:', new Date(payload.exp * 1000));
        console.log('是否过期:', Date.now() > payload.exp * 1000);
    } catch (e) {
        console.error('token解析失败:', e);
    }
}
            </div>
        </div>

        <div class="step">
            <h3>步骤2: 监听经验值更新事件</h3>
            <p>在控制台运行以下代码来监听经验值更新：</p>
            <div class="code">
// 监听经验值更新事件
window.addEventListener('experienceUpdated', function(event) {
    console.log('🎉 经验值更新事件触发:', event.detail);
    console.log('获得经验值:', event.detail.experienceGained);
    console.log('新经验值:', event.detail.newExperience);
    console.log('新等级:', event.detail.newLevel);
    console.log('是否升级:', event.detail.leveledUp);
});

console.log('✅ 经验值更新事件监听器已设置');
            </div>
        </div>

        <div class="step">
            <h3>步骤3: 监听网络请求</h3>
            <p>打开开发者工具的Network面板，过滤"addExperience"来监听API调用。</p>
        </div>

        <div class="step">
            <h3>步骤4: 完成测验</h3>
            <p>现在去完成第一章的测验，观察：</p>
            <ul>
                <li>控制台是否有"🎯 开始添加经验值和检查成就..."的日志</li>
                <li>控制台是否有"📈 计算得到经验值: XX"的日志</li>
                <li>Network面板是否有/api/level/addExperience的请求</li>
                <li>是否触发了experienceUpdated事件</li>
                <li>是否显示了"获得 XX 经验值！"的成功提示</li>
            </ul>
        </div>

        <div class="step">
            <h3>步骤5: 检查个人资料页面</h3>
            <p>完成测验后，访问个人资料页面，检查经验值是否更新。</p>
        </div>

        <div class="success">
            <strong>🔍 调试提示：</strong>
            <ul>
                <li>如果没有看到"🎯 开始添加经验值"日志，说明completeQuiz方法没有被调用</li>
                <li>如果看到"🚫 未登录，跳过经验值添加"，说明token有问题</li>
                <li>如果看到API调用但没有成功，检查后端日志</li>
                <li>如果API成功但个人资料页面没更新，检查事件监听</li>
            </ul>
        </div>

        <div class="step">
            <h3>快速链接</h3>
            <p>
                <a href="http://localhost:5174/quiz/1" target="_blank">📝 第一章测验</a> |
                <a href="http://localhost:5174/profile" target="_blank">👤 个人资料页面</a>
            </p>
        </div>
    </div>

    <script>
        console.log('🧪 测验完成测试页面已加载');
        console.log('请按照页面上的步骤进行测试');
    </script>
</body>
</html>