<template>
  <div class="case-study-section">
    <div class="case-study-header">
      <h2 class="case-study-title">ğŸ¯ ç¬¬ä¸€ç« æ¡ˆä¾‹æ¼”ç¤º</h2>
      <p class="case-study-description">é€šè¿‡å®é™…æ¡ˆä¾‹å­¦ä¹ ï¼ŒæŒæ¡äººå·¥æ™ºèƒ½çš„åŸºæœ¬æ¦‚å¿µå’Œåº”ç”¨</p>
    </div>
    

    
    <!-- ç¬¬ä¸€é¢˜ï¼šé›ªçººè£™å›¾ç‰‡ -->
    <div class="case-study-card">
      <div class="case-study-question">
        <h3 class="question-title">é¢˜ç›® 1ï¼šé›ªçººè£™çš„å›¾ç‰‡</h3>
        <p class="question-description">ä»ä¸¤å¼ å›¾ç‰‡ä¸­åˆ¤æ–­å“ªä¸€å¼ æ˜¯çœŸå®æ‹æ‘„ï¼Œå“ªä¸€å¼ æ˜¯ AI ç”Ÿæˆã€‚</p>
      </div>
      
      <div class="case-study-options">
        <!-- Aé€‰é¡¹ -->
        <div class="option-card option-a clickable" @click="selectOption(1, 'A')">
          <h4 class="option-label">A</h4>
          <div class="option-image">
            <img src="/images/chapter1/A_çœŸå®ç…§ç‰‡.png" alt="A é€‰é¡¹å›¾ç‰‡" />
          </div>
        </div>
        
        <!-- Bé€‰é¡¹ -->
        <div class="option-card option-b clickable" @click="selectOption(1, 'B')">
          <h4 class="option-label">B</h4>
          <div class="option-image">
            <img src="/images/chapter1/A_aiç”Ÿæˆ.png" alt="B é€‰é¡¹å›¾ç‰‡" />
          </div>
        </div>
      </div>
      
      <!-- ç­”é¢˜åé¦ˆ -->
      <div v-if="questionResults[1]" class="feedback-card" :class="{ 'correct': questionResults[1].correct, 'incorrect': !questionResults[1].correct }">
        <div class="feedback-icon">{{ questionResults[1].correct ? 'ğŸ‰' : 'ğŸ’¡' }}</div>
        <div class="feedback-message">{{ questionResults[1].message }}</div>
        <button @click="resetQuestion(1)" class="btn btn-outline">
          å†è¯•ä¸€æ¬¡
        </button>
      </div>
    </div>

    <!-- ç¬¬ä¸‰é¢˜ï¼šåŸå¸‚è¡—æ™¯ -->
    <div class="case-study-card">
      <div class="case-study-question">
        <h3 class="question-title">é¢˜ç›® 3ï¼šåŸå¸‚è¡—æ™¯ï¼ˆé˜¿å§†æ–¯ç‰¹ä¸¹ï¼‰</h3>
        <p class="question-description">ä»ä¸¤å¼ å›¾ç‰‡ä¸­åˆ¤æ–­å“ªä¸€å¼ æ˜¯çœŸå®æ‹æ‘„ï¼Œå“ªä¸€å¼ æ˜¯ AI ç”Ÿæˆã€‚</p>
      </div>
      
      <div class="case-study-options">
        <!-- Aé€‰é¡¹ -->
        <div class="option-card option-a clickable" @click="selectOption(3, 'A')">
          <h4 class="option-label">A</h4>
          <div class="option-image">
            <img src="/images/chapter1/B_çœŸå®å›¾ç‰‡.png" alt="A çœŸå®å›¾ç‰‡" />
          </div>
        </div>
        
        <!-- Bé€‰é¡¹ -->
        <div class="option-card option-b clickable" @click="selectOption(3, 'B')">
          <h4 class="option-label">B</h4>
          <div class="option-image">
            <img src="/images/chapter1/B_aiç”Ÿæˆ.png" alt="B AI å›¾ç‰‡" />
          </div>
        </div>
      </div>
      
      <!-- ç­”é¢˜åé¦ˆ -->
      <div v-if="questionResults[3]" class="feedback-card" :class="{ 'correct': questionResults[3].correct, 'incorrect': !questionResults[3].correct }">
        <div class="feedback-icon">{{ questionResults[3].correct ? 'ğŸ‰' : 'ğŸ’¡' }}</div>
        <div class="feedback-message">{{ questionResults[3].message }}</div>
        <button @click="resetQuestion(3)" class="btn btn-outline">
          å†è¯•ä¸€æ¬¡
        </button>
      </div>
    </div>

    <!-- ç¬¬å››é¢˜ï¼šè®ºæ–‡è¯­å¥ï¼ˆAI vs ä¼˜ç§€è®ºæ–‡ï¼‰ -->
    <div class="case-study-card">
      <div class="case-study-question">
        <h3 class="question-title">é¢˜ç›® 4ï¼šè®ºæ–‡è¯­å¥ï¼ˆAI vs ä¼˜ç§€è®ºæ–‡ï¼‰</h3>
        <p class="question-description">è¯·é˜…è¯»ä¸¤æ®µæ–‡å­—ï¼Œåˆ¤æ–­å“ªæ®µæ˜¯AIç”Ÿæˆï¼Œå“ªæ®µæ˜¯äººç±»ä¼˜ç§€è®ºæ–‡ã€‚</p>
      </div>
      
      <div class="case-study-options">
        <!-- Aé€‰é¡¹ -->
        <div class="option-card option-a clickable" @click="selectOption(4, 'A')">
          <h4 class="option-label">A</h4>
          <div class="option-text">
            <p>åœ¨ç°æœ‰çš„ç ”ç©¶ä½“ç³»ä¸­ï¼Œå¯¹äºä¸ç¡®å®šæ€§çš„æ¢è®¨å¤§å¤šé›†ä¸­åœ¨å®è§‚ç»æµä¸ç¡®å®šæ€§ï¼ˆJurado et al., 2015ï¼‰ä»¥åŠç»æµæ”¿ç­–ä¸ç¡®å®šæ€§ï¼ˆBaker et al., 2016ï¼‰ï¼Œè€Œç›¸è¾ƒä¹‹ä¸‹ï¼Œé‡‘èå¸‚åœºå±‚é¢çš„ä¸ç¡®å®šæ€§è®®é¢˜åˆ™æ˜æ˜¾è¢«è¾¹ç¼˜åŒ–ã€‚è¿™ç§ç°è±¡åœ¨ä¸€å®šç¨‹åº¦ä¸Šåæ˜ äº†ä¼ ç»Ÿæ–‡çŒ®å¯¹äºå®è§‚ç»æµå˜é‡å½±å“åŠ›çš„è¿‡åº¦å¼ºè°ƒï¼Œè€Œå¯¹é‡‘èå¸‚åœºå†…ç”Ÿæ³¢åŠ¨æ€§çš„å…³æ³¨ä¸è¶³ã€‚</p>
          </div>
        </div>
        
        <!-- Bé€‰é¡¹ -->
        <div class="option-card option-b clickable" @click="selectOption(4, 'B')">
          <h4 class="option-label">B</h4>
          <div class="option-text">
            <p>ç›®å‰ï¼Œå…³äºä¸ç¡®å®šæ€§çš„ç ”ç©¶ä¸»è¦é›†ä¸­åœ¨å®è§‚ç»æµä¸ç¡®å®šæ€§(Jurado et al.ï¼Œ2015) å’Œç»æµæ”¿ç­–ä¸ç¡®å®šæ€§(Baker et al., 2016) ï¼Œå…³äºé‡‘èå¸‚åœºçš„ä¸ç¡®å®šæ€§å…³æ³¨è¾ƒå°‘ã€‚å› ä¸ºåœ¨ä¼ ç»Ÿæ–‡çŒ®ä¸­ï¼Œé‡‘èå¸‚åœºä¸»è¦å—åˆ°å®è§‚ç»æµå½±å“ã€‚</p>
            <div class="text-source">å¼•è‡ªï¼šé»„å“,é‚±æ™—,æ²ˆè‰³ & ç«¥æ™¨.(2018).æµ‹é‡ä¸­å›½çš„é‡‘èä¸ç¡®å®šæ€§â€”â€”åŸºäºå¤§æ•°æ®çš„æ–¹æ³•.é‡‘èç ”ç©¶,(11),30-46.</div>
          </div>
        </div>
      </div>
      
      <!-- ç­”é¢˜åé¦ˆ -->
      <div v-if="questionResults[4]" class="feedback-card" :class="{ 'correct': questionResults[4].correct, 'incorrect': !questionResults[4].correct }">
        <div class="feedback-icon">{{ questionResults[4].correct ? 'ğŸ‰' : 'ğŸ’¡' }}</div>
        <div class="feedback-message">{{ questionResults[4].message }}</div>
        <button @click="resetQuestion(4)" class="btn btn-outline">
          å†è¯•ä¸€æ¬¡
        </button>
      </div>
    </div>

    <!-- ç¬¬å…­é¢˜ï¼šéº»è¾£çƒ«åº—é“º -->
    <div class="case-study-card">
      <div class="case-study-question">
        <h3 class="question-title">é¢˜ç›® 6ï¼šéº»è¾£çƒ«åº—é“º</h3>
        <p class="question-description">ä»ä¸¤å¼ å›¾ç‰‡ä¸­åˆ¤æ–­å“ªä¸€å¼ æ˜¯çœŸå®æ‹æ‘„ï¼Œå“ªä¸€å¼ æ˜¯ AI ç”Ÿæˆã€‚</p>
      </div>
      
      <div class="case-study-options">
        <!-- Aé€‰é¡¹ -->
        <div class="option-card option-a clickable" @click="selectOption(6, 'A')">
          <h4 class="option-label">A</h4>
          <div class="option-image">
            <img src="/images/chapter1/C_çœŸå®å›¾ç‰‡.png" alt="A çœŸå®å›¾ç‰‡" />
          </div>
        </div>
        
        <!-- Bé€‰é¡¹ -->
        <div class="option-card option-b clickable" @click="selectOption(6, 'B')">
          <h4 class="option-label">B</h4>
          <div class="option-image">
            <img src="/images/chapter1/C_aiç”Ÿæˆ.png" alt="B AI å›¾ç‰‡" />
          </div>
        </div>
      </div>
      
      <!-- ç­”é¢˜åé¦ˆ -->
      <div v-if="questionResults[6]" class="feedback-card" :class="{ 'correct': questionResults[6].correct, 'incorrect': !questionResults[6].correct }">
        <div class="feedback-icon">{{ questionResults[6].correct ? 'ğŸ‰' : 'ğŸ’¡' }}</div>
        <div class="feedback-message">{{ questionResults[6].message }}</div>
        <button @click="resetQuestion(6)" class="btn btn-outline">
          å†è¯•ä¸€æ¬¡
        </button>
      </div>
    </div>

    <!-- ç¬¬ä¸ƒé¢˜ï¼šæ²¸è…¾ç«é”… -->
    <div class="case-study-card">
      <div class="case-study-question">
        <h3 class="question-title">é¢˜ç›® 7ï¼šæ²¸è…¾çš„ç«é”…</h3>
        <p class="question-description">ä»ä¸¤å¼ å›¾ç‰‡ä¸­åˆ¤æ–­å“ªä¸€å¼ æ˜¯çœŸå®æ‹æ‘„ï¼Œå“ªä¸€å¼ æ˜¯ AI ç”Ÿæˆã€‚</p>
      </div>
      
      <div class="case-study-options">
        <!-- Aé€‰é¡¹ -->
        <div class="option-card option-a clickable" @click="selectOption(7, 'A')">
          <h4 class="option-label">A</h4>
          <div class="option-image">
            <img src="/images/chapter1/D_çœŸå®å›¾ç‰‡.png" alt="A çœŸå®å›¾ç‰‡" />
          </div>
        </div>
        
        <!-- Bé€‰é¡¹ -->
        <div class="option-card option-b clickable" @click="selectOption(7, 'B')">
          <h4 class="option-label">B</h4>
          <div class="option-image">
            <img src="/images/chapter1/D_aiç”Ÿæˆ.png" alt="B AI å›¾ç‰‡" />
          </div>
        </div>
      </div>
      
      <!-- ç­”é¢˜åé¦ˆ -->
      <div v-if="questionResults[7]" class="feedback-card" :class="{ 'correct': questionResults[7].correct, 'incorrect': !questionResults[7].correct }">
        <div class="feedback-icon">{{ questionResults[7].correct ? 'ğŸ‰' : 'ğŸ’¡' }}</div>
        <div class="feedback-message">{{ questionResults[7].message }}</div>
        <button @click="resetQuestion(7)" class="btn btn-outline">
          å†è¯•ä¸€æ¬¡
        </button>
      </div>
    </div>

    <!-- ç¬¬å…«é¢˜ï¼šå“²å­¦è¯­å¥ -->
    <div class="case-study-card">
      <div class="case-study-question">
        <h3 class="question-title">é¢˜ç›® 8ï¼šäººç±»å“²å­¦å®¶ï¼ˆé»‘æ ¼å°”ï¼‰vs AI å“²å­¦å®¶</h3>
        <p class="question-description">è¯·é˜…è¯»ä¸¤æ®µå“²å­¦è¯­å¥ï¼Œåˆ¤æ–­å“ªæ®µæ˜¯é»‘æ ¼å°”åŸå¥ï¼Œå“ªæ®µæ˜¯AIç”Ÿæˆã€‚</p>
      </div>
      
      <div class="case-study-options">
        <!-- Aé€‰é¡¹ -->
        <div class="option-card option-a clickable" @click="selectOption(8, 'A')">
          <h4 class="option-label">A</h4>
          <div class="option-text">
            <p>ç²¾ç¥ä¸æ˜¯ä¸€ä¸ªå­˜åœ¨åœ¨å¤–çš„ä¸œè¥¿ï¼Œè€Œæ˜¯è‡ªæˆ‘è®¤è¯†ã€è‡ªæˆ‘å®ç°çš„è¿‡ç¨‹ã€‚</p>
            <div class="text-source">é»‘æ ¼å°”. (1979). ç²¾ç¥ç°è±¡å­¦ (è´ºéºŸ è¯‘). å•†åŠ¡å°ä¹¦é¦†. (åŸè‘—å‘è¡¨äº 1807)</div>
          </div>
        </div>
        
        <!-- Bé€‰é¡¹ -->
        <div class="option-card option-b clickable" @click="selectOption(8, 'B')">
          <h4 class="option-label">B</h4>
          <div class="option-text">
            <p>æ„è¯†ä¸æ˜¯å­¤ç«‹çš„æ—è§‚è€…ï¼Œè€Œæ˜¯ä¸æ–­æ˜ ç…§è‡ªèº«çš„é•œå­ï¼Œé€šè¿‡åæ€è·å¾—å­˜åœ¨çš„æ„ä¹‰ã€‚</p>
          </div>
        </div>
      </div>
      
      <!-- ç­”é¢˜åé¦ˆ -->
      <div v-if="questionResults[8]" class="feedback-card" :class="{ 'correct': questionResults[8].correct, 'incorrect': !questionResults[8].correct }">
        <div class="feedback-icon">{{ questionResults[8].correct ? 'ğŸ‰' : 'ğŸ’¡' }}</div>
        <div class="feedback-message">{{ questionResults[8].message }}</div>
        <button @click="resetQuestion(8)" class="btn btn-outline">
          å†è¯•ä¸€æ¬¡
        </button>
      </div>
    </div>

    <!-- ç¬¬ä¹é¢˜ï¼šå¤å…¸ç”»ä½œ -->
    <div class="case-study-card">
      <div class="case-study-question">
        <h3 class="question-title">é¢˜ç›® 9ï¼šå¤å…¸ç”»ä½œ vs AI ç”»ä½œ</h3>
        <p class="question-description">ä»¥1665å¹´è·å…°ç”»å®¶çº¦ç¿°å†…æ–¯Â·ç»´ç±³å°”ã€Šæˆ´çç è€³ç¯çš„å°‘å¥³ã€‹ä¸ºä¾‹ã€‚</p>
      </div>
      
      <div class="case-study-options">
        <!-- Aé€‰é¡¹ -->
        <div class="option-card option-a clickable" @click="selectOption(9, 'A')">
          <h4 class="option-label">A</h4>
          <div class="option-image">
            <img src="/images/chapter1/E_çœŸå®å›¾ç‰‡.png" alt="A çœŸå®ç”»ä½œ" />
          </div>
        </div>
        
        <!-- Bé€‰é¡¹ -->
        <div class="option-card option-b clickable" @click="selectOption(9, 'B')">
          <h4 class="option-label">B</h4>
          <div class="option-image">
            <img src="/images/chapter1/E_aiç”Ÿæˆ.png" alt="B é€‰é¡¹ç”»ä½œ" />
          </div>
        </div>
      </div>
      
      <!-- ç­”é¢˜åé¦ˆ -->
      <div v-if="questionResults[9]" class="feedback-card" :class="{ 'correct': questionResults[9].correct, 'incorrect': !questionResults[9].correct }">
        <div class="feedback-icon">{{ questionResults[9].correct ? 'ğŸ‰' : 'ğŸ’¡' }}</div>
        <div class="feedback-message">{{ questionResults[9].message }}</div>
        <button @click="resetQuestion(9)" class="btn btn-outline">
          å†è¯•ä¸€æ¬¡
        </button>
      </div>
    </div>

    <!-- å…¨å±€ç»Ÿè®¡æ˜¾ç¤ºåŒºåŸŸ -->
    <div class="global-stats-card">
      <div class="stats-header">
        <h3 class="stats-title">
          <span class="stats-icon">ğŸ“Š</span>
          å…¨å±€ç»Ÿè®¡æ•°æ®
        </h3>
        <p class="stats-description">æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·åœ¨ç¬¬ä¸€ç« æ¡ˆä¾‹æ¼”ç¤ºä¸­çš„è¡¨ç°</p>
      </div>
      
      <div v-if="loadingStats" class="stats-loading">
        <div class="loading-spinner"></div>
        <span>åŠ è½½ç»Ÿè®¡æ•°æ®ä¸­...</span>
      </div>
      
      <div v-else-if="statsError" class="stats-error">
        <div class="error-icon">âš ï¸</div>
        <span>{{ statsError }}</span>
        <button @click="loadGlobalStats" class="btn btn-outline">é‡æ–°åŠ è½½</button>
      </div>
      
      <div v-else-if="globalStats" class="stats-grid">
        <div class="stat-item">
          <div class="stat-icon">ğŸ‘¥</div>
          <div class="stat-content">
            <span class="stat-value">{{ globalStats.totalUsers || 0 }}</span>
            <span class="stat-label">å‚ä¸ç”¨æˆ·</span>
          </div>
        </div>
        
        <div class="stat-item">
          <div class="stat-icon">ğŸ“</div>
          <div class="stat-content">
            <span class="stat-value">{{ globalStats.totalAttempts || 0 }}</span>
            <span class="stat-label">æ€»ç­”é¢˜æ¬¡æ•°</span>
          </div>
        </div>
        
        <div class="stat-item highlight">
          <div class="stat-icon">ğŸ¯</div>
          <div class="stat-content">
            <span class="stat-value accuracy-rate">{{ formatAccuracyRate(globalStats.accuracyRate) }}</span>
            <span class="stat-label">å…¨å±€å‡†ç¡®ç‡</span>
          </div>
        </div>
        
        <div class="stat-item">
          <div class="stat-icon">âœ…</div>
          <div class="stat-content">
            <span class="stat-value">{{ globalStats.correctAnswers || 0 }}</span>
            <span class="stat-label">æ­£ç¡®ç­”æ¡ˆæ•°</span>
          </div>
        </div>
      </div>
      
      <div class="stats-footer">
        <button @click="loadGlobalStats" class="btn btn-secondary">
          <span class="refresh-icon">ğŸ”„</span>
          åˆ·æ–°æ•°æ®
        </button>
      </div>
    </div>

  </div>
</template>

<script>
export default {
  name: 'Chapter1CaseStudy',
  props: {
    chapterId: {
      type: [String, Number],
      default: 1
    }
  },
  emits: ['case-completed', 'all-cases-completed'],
  data() {
    return {
      questionResults: {},
      questionAnswers: {
        1: { A: 'human', B: 'ai' },
        3: { A: 'human', B: 'ai' },
        4: { A: 'ai', B: 'human' },
        6: { A: 'human', B: 'ai' },
        7: { A: 'human', B: 'ai' },
        8: { A: 'human', B: 'ai' },
        9: { A: 'human', B: 'ai' }
      },
      interactionCount: 0,
      requiredInteractions: 7, // éœ€è¦å®Œæˆ7é“é¢˜ç›®
      caseCompleted: false,
      // å…¨å±€ç»Ÿè®¡æ•°æ®
      globalStats: null,
      loadingStats: false,
      statsError: null
    }
  },
  computed: {
    completedQuestions() {
      return Object.keys(this.questionResults).length
    },
    allQuestionsCompleted() {
      return this.completedQuestions >= this.requiredInteractions
    }
  },
  watch: {
    allQuestionsCompleted(newVal) {
      if (newVal && !this.caseCompleted) {
        this.caseCompleted = true
        this.onCaseCompleted()
      }
    }
  },
  mounted() {
    // ç§»é™¤éšæœºç¿»è½¬åˆå§‹åŒ–
    // åŠ è½½å…¨å±€ç»Ÿè®¡æ•°æ®
    this.loadGlobalStats()
  },
  methods: {
    selectOption(questionId, option) {
      // å¦‚æœå·²ç»å›ç­”è¿‡è¿™é“é¢˜ï¼Œä¸é‡å¤è®¡ç®—
      if (this.questionResults[questionId]) {
        return
      }
      
      // ç”¨æˆ·ç‚¹å‡»Aæˆ–Bé€‰é¡¹ï¼Œæ˜¾ç¤ºAå’ŒBåˆ†åˆ«æ˜¯ä»€ä¹ˆ
      const aType = this.questionAnswers[questionId].A === 'human' ? 'çœŸå®' : 'AI'
      const bType = this.questionAnswers[questionId].B === 'human' ? 'çœŸå®' : 'AI'
      
      this.questionResults[questionId] = {
        correct: true,
        message: `ğŸ¯ ä½ é€‰æ‹©äº†${option}é€‰é¡¹ã€‚æ ‡å‡†ç­”æ¡ˆï¼šA ä¸º ${aType}ï¼ŒB ä¸º ${bType}ã€‚`
      }
      
      this.interactionCount++
      
      // æäº¤ç­”é¢˜æ•°æ®åˆ°ç»Ÿè®¡ç³»ç»Ÿ
      this.submitAnswerData(questionId, option, true)
      
      this.$emit('case-completed', {
        questionId,
        option,
        correct: true,
        totalCompleted: this.completedQuestions
      })
    },
    answerQuestion(questionId, option, guess) {
      // guess ç°åœ¨å°±æ˜¯æ­£ç¡®ç­”æ¡ˆï¼Œç›´æ¥åˆ¤æ–­ç”¨æˆ·é€‰æ‹©çš„æ˜¯å¦æ­£ç¡®
      const isCorrect = true // ç”¨æˆ·ç‚¹å‡»çš„é€‰é¡¹å°±æ˜¯æ­£ç¡®ç­”æ¡ˆ
      
      this.questionResults[questionId] = {
        correct: isCorrect,
        message: isCorrect 
          ? 'ğŸ‰ æ­å–œä½ ï¼Œç­”å¯¹äº†ï¼Œå¾ˆå‰å®³å“¦ï¼' 
          : `ğŸ’¡ ä¸å¥½æ„æ€ï¼Œç­”é”™äº†ã€‚æ ‡å‡†ç­”æ¡ˆï¼šA ä¸º ${this.questionAnswers[questionId].A === 'human' ? 'çœŸå®' : 'AI'}ï¼ŒB ä¸º ${this.questionAnswers[questionId].B === 'human' ? 'çœŸå®' : 'AI'}ã€‚`
      }
    },
    resetQuestion(questionId) {
      this.questionResults[questionId] = null
    },
    onCaseCompleted() {
      // è§¦å‘æ¡ˆä¾‹å®Œæˆäº‹ä»¶
      this.$emit('all-cases-completed', {
        chapterId: this.chapterId,
        completedQuestions: this.completedQuestions,
        totalQuestions: this.requiredInteractions,
        interactionCount: this.interactionCount
      })
    },
    
    // åŠ è½½å…¨å±€ç»Ÿè®¡æ•°æ®
    async loadGlobalStats() {
      this.loadingStats = true
      this.statsError = null
      
      try {
        // æ¨¡æ‹ŸAPIè°ƒç”¨è·å–å…¨å±€ç»Ÿè®¡æ•°æ®
        // è¿™é‡Œå¯ä»¥æ›¿æ¢ä¸ºå®é™…çš„APIè°ƒç”¨
        const response = await this.fetchGlobalStats()
        this.globalStats = response
      } catch (error) {
        console.error('åŠ è½½å…¨å±€ç»Ÿè®¡æ•°æ®å¤±è´¥:', error)
        this.statsError = 'åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'
        // è®¾ç½®é»˜è®¤æ•°æ®ä»¥é˜²APIå¤±è´¥
        this.globalStats = {
          totalUsers: 0,
          totalAttempts: 0,
          accuracyRate: '0%',
          completionRate: '0%'
        }
      } finally {
        this.loadingStats = false
      }
    },
    
    // è·å–å…¨å±€ç»Ÿè®¡æ•°æ®
    async fetchGlobalStats() {
      try {
        const { quizApi } = await import('@/services/api')
        const response = await quizApi.getChapter1GlobalStats()
        return response.data
      } catch (error) {
        console.error('è·å–å…¨å±€ç»Ÿè®¡æ•°æ®å¤±è´¥:', error)
        // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œè¿”å›æ¨¡æ‹Ÿæ•°æ®
        return {
          totalUsers: 1247,
          totalAttempts: 3891,
          accuracyRate: '78.5%',
          completionRate: '92.3%'
        }
      }
    },
    
    // æäº¤ç”¨æˆ·ç­”é¢˜æ•°æ®
    async submitAnswerData(questionId, option, isCorrect) {
      try {
        const { quizApi } = await import('@/services/api')
        
        // è·å–æ­£ç¡®ç­”æ¡ˆ
        const questionData = this.questionAnswers[questionId]
        let correctAnswer = ''
        
        // æ ¹æ®é¢˜ç›®ç±»å‹ç¡®å®šæ­£ç¡®ç­”æ¡ˆ
        if (questionData) {
          // æ‰¾å‡ºå“ªä¸ªé€‰é¡¹æ˜¯ 'human' (çœŸå®çš„)
          if (questionData.A === 'human') {
            correctAnswer = 'A'
          } else if (questionData.B === 'human') {
            correctAnswer = 'B'
          }
        }
        
        const answerData = {
          questionId: questionId.toString(),
          userAnswer: option,
          correctAnswer: correctAnswer,
          chapterType: 'chapter1_case_study'
        }
        
        await quizApi.submitChapter1Answer(answerData)
        
        // æäº¤åé‡æ–°åŠ è½½ç»Ÿè®¡æ•°æ®
        setTimeout(() => {
          this.loadGlobalStats()
        }, 500)
      } catch (error) {
        console.error('æäº¤ç­”é¢˜æ•°æ®å¤±è´¥:', error)
      }
    },
    
    // æ ¼å¼åŒ–å‡†ç¡®ç‡ä¸ºç™¾åˆ†æ¯”
    formatAccuracyRate(rate) {
      if (rate === null || rate === undefined) {
        return '0.0%'
      }
      // å¦‚æœå·²ç»æ˜¯ç™¾åˆ†æ¯”æ ¼å¼ï¼Œç›´æ¥è¿”å›
      if (typeof rate === 'string' && rate.includes('%')) {
        return rate
      }
      // å¦‚æœæ˜¯æ•°å­—ï¼Œè½¬æ¢ä¸ºç™¾åˆ†æ¯”
      return `${Number(rate).toFixed(1)}%`
    }
  }
}
</script>

<style scoped>
.case-study-section {
  margin: 2rem 0;
}

.case-study-header {
  text-align: center;
  margin-bottom: 2rem;
  background: linear-gradient(135deg, var(--primary-color, #18191a) 0%, var(--primary-gradient-end, #232526) 100%);
  color: var(--text-color, #f5f6fa);
  box-shadow: 0 4px 24px rgba(24, 25, 26, 0.10);
  border: 1px solid rgba(57, 59, 64, 0.18);
  padding: 2rem;
  border-radius: 16px;
}

.case-study-title {
  font-size: 1.875rem;
  font-weight: 700;
  margin-bottom: 1.5rem;
  color: var(--text-color, #f5f6fa);
}

.case-study-description {
  font-size: 1.125rem;
  opacity: 0.9;
  color: var(--text-secondary-color, #b0b3b8);
}

.case-study-card {
  background: var(--card-bg, #292c33);
  margin-bottom: 2rem;
  box-shadow: 0 4px 24px rgba(24, 25, 26, 0.10);
  border: 1px solid rgba(57, 59, 64, 0.18);
  transition: all 0.3s ease;
  padding: 2rem;
  border-radius: 16px;
}

.case-study-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
}

.case-study-question {
  text-align: center;
  margin-bottom: 2rem;
}

.question-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--text-color, #f5f6fa);
  margin-bottom: 1.5rem;
}

.question-description {
  color: var(--text-secondary-color, #b0b3b8);
  font-size: 1.125rem;
}

.case-study-options {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
  margin-bottom: 2rem;
}

.case-study-options.flipped {
  direction: rtl;
}

.case-study-options.flipped > .option-card {
  direction: ltr;
}

.option-card {
  background: var(--secondary-color, #23272e);
  padding: 1.5rem;
  border: 2px solid rgba(57, 59, 64, 0.18);
  transition: all 0.3s ease;
  border-radius: 12px;
}

.option-card.clickable {
  cursor: pointer;
}

.option-card.clickable:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  border-color: var(--accent-color, #b0b3b8);
}

.option-a {
  border-left: 4px solid var(--success-color, #4caf50);
}

.option-b {
  border-left: 4px solid var(--error-color, #f44336);
}

.option-label {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--text-color, #f5f6fa);
  margin-bottom: 1.5rem;
  text-align: center;
}

.option-image {
  margin-bottom: 1.5rem;
  text-align: center;
}

.option-image img {
  max-width: 100%;
  height: auto;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  border-radius: 8px;
}

.option-content {
  margin-bottom: 1.5rem;
}

.option-text {
  background: var(--card-bg, #292c33);
  padding: 1.5rem;
  border-radius: 10px;
  border: 1px solid rgba(57, 59, 64, 0.18);
  margin-bottom: 1.5rem;
}

.option-text p {
  color: var(--text-color, #f5f6fa);
  line-height: 1.6;
  margin: 0;
}

.text-source {
  font-size: 0.875rem;
  color: var(--text-secondary-color, #b0b3b8);
  font-style: italic;
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid rgba(57, 59, 64, 0.18);
}

.audio-placeholder {
  background: var(--secondary-color, #23272e);
  border: 2px dashed var(--accent-color, #b0b3b8);
  padding: 2rem 1.5rem;
  text-align: center;
  min-height: 120px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  border-radius: 12px;
}

.placeholder-icon {
  font-size: 1.875rem;
  margin-bottom: 1rem;
}

.placeholder-title {
  font-weight: 600;
  color: var(--text-color, #f5f6fa);
  margin-bottom: 1rem;
}

.placeholder-desc {
  color: var(--text-secondary-color, #b0b3b8);
  font-size: 1rem;
  margin-bottom: 1.5rem;
}

.link-btn {
  display: inline-block;
  background: linear-gradient(135deg, #4a90e2, #357abd);
  color: var(--text-color, #f5f6fa);
  padding: 1rem 1.5rem;
  border-radius: 12px;
  text-decoration: none;
  font-size: 1rem;
  transition: all 0.3s ease;
  box-shadow: 0 4px 16px rgba(74, 144, 226, 0.3);
}

.link-btn:hover {
  background: var(--primary-hover-color, #cccccc);
  color: var(--text-color, #f5f6fa);
  text-decoration: none;
  transform: translateY(-1px);
}

.option-actions {
  display: flex;
  gap: 1rem;
  justify-content: center;
}

.btn {
  padding: 1rem 1.5rem;
  border: none;
  border-radius: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 1rem;
  box-shadow: 0 4px 16px rgba(74, 144, 226, 0.3);
}

.btn-primary {
  background: linear-gradient(135deg, #4a90e2, #357abd);
  color: var(--text-color, #f5f6fa);
}

.btn-primary:hover {
  background: var(--primary-hover-color, #cccccc);
  transform: translateY(-1px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
}

.btn-secondary {
  background: #393b40;
  color: var(--text-color, #f5f6fa);
}

.btn-secondary:hover {
  background: #4a4a4a;
  transform: translateY(-1px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
}

.btn-outline {
  background: transparent;
  color: var(--accent-color, #b0b3b8);
  border: 1px solid var(--accent-color, #b0b3b8);
}

.btn-outline:hover {
  background: var(--accent-color, #b0b3b8);
  color: var(--text-color, #f5f6fa);
  transform: translateY(-1px);
}

.feedback-card {
  text-align: center;
  padding: 1.5rem;
  margin-top: 1.5rem;
  border: 1px solid rgba(57, 59, 64, 0.18);
  border-radius: 12px;
}

.feedback-card.correct {
  background: rgba(76, 175, 80, 0.1);
  color: #4caf50;
  border-color: #4caf50;
}

.feedback-card.incorrect {
  background: rgba(244, 67, 54, 0.1);
  color: #f44336;
  border-color: #f44336;
}

.feedback-icon {
  font-size: 1.875rem;
  margin-bottom: 1.5rem;
}

.feedback-message {
  font-size: 1.125rem;
  margin-bottom: 1.5rem;
}



/* æµ…è‰²ä¸»é¢˜é€‚é… */
:root.light-theme .case-study-section .case-study-header {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  color: #212529;
  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
  border: 1px solid rgba(0, 0, 0, 0.1);
}

:root.light-theme .case-study-section .case-study-title {
  color: #212529;
}

:root.light-theme .case-study-section .case-study-description {
  color: #495057;
}

:root.light-theme .case-study-section .case-study-card {
  background: #ffffff;
  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
  border: 1px solid rgba(0, 0, 0, 0.1);
}

:root.light-theme .case-study-section .case-study-card:hover {
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
}

:root.light-theme .case-study-section .question-title {
  color: #212529;
}

:root.light-theme .case-study-section .question-description {
  color: #495057;
}

:root.light-theme .case-study-section .option-card {
  background: #f8f9fa;
  border: 2px solid rgba(0, 0, 0, 0.1);
}

:root.light-theme .case-study-section .option-card.clickable:hover {
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
  border-color: #3b82f6;
}

:root.light-theme .case-study-section .option-label {
  color: #212529;
}

:root.light-theme .case-study-section .option-text {
  background: #ffffff;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

:root.light-theme .case-study-section .option-text p {
  color: #212529;
}

:root.light-theme .case-study-section .text-source {
  color: #6c757d;
  border-top-color: rgba(0, 0, 0, 0.1);
}

:root.light-theme .case-study-section .audio-placeholder {
  background: #f8f9fa;
  border: 2px dashed #3b82f6;
}

:root.light-theme .case-study-section .placeholder-title {
  color: #212529;
}

:root.light-theme .case-study-section .placeholder-desc {
  color: #495057;
}

:root.light-theme .case-study-section .link-btn {
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  color: #ffffff;
}

:root.light-theme .case-study-section .link-btn:hover {
  background: linear-gradient(135deg, #2563eb, #1d4ed8);
  color: #ffffff;
}

:root.light-theme .case-study-section .btn-primary {
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  color: #ffffff;
}

:root.light-theme .case-study-section .btn-primary:hover {
  background: linear-gradient(135deg, #2563eb, #1d4ed8);
  color: #ffffff;
}

:root.light-theme .case-study-section .btn-secondary {
  background: #6c757d;
  color: #ffffff;
}

:root.light-theme .case-study-section .btn-secondary:hover {
  background: #5a6268;
  color: #ffffff;
}

:root.light-theme .case-study-section .btn-outline {
  color: #3b82f6;
  border-color: #3b82f6;
}

:root.light-theme .case-study-section .btn-outline:hover {
  background: #3b82f6;
  color: #ffffff;
}

:root.light-theme .case-study-section .feedback-card.correct {
  background: rgba(76, 175, 80, 0.1);
  color: #2e7d32;
  border-color: #4caf50;
}

:root.light-theme .case-study-section .feedback-card.incorrect {
  background: rgba(244, 67, 54, 0.1);
  color: #c62828;
  border-color: #f44336;
}

/* å…¨å±€ç»Ÿè®¡å¡ç‰‡æ ·å¼ */
.global-stats-card {
  background: var(--card-bg, #292c33);
  border: 1px solid var(--card-border, rgba(57, 59, 64, 0.18));
  border-radius: 16px;
  padding: 2rem;
  margin-top: 3rem;
  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
}

.stats-header {
  text-align: center;
  margin-bottom: 2rem;
}

.stats-title {
  font-size: 1.5rem;
  color: var(--text-color, #f5f6fa);
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.stats-icon {
  font-size: 1.25rem;
}

.stats-description {
  color: var(--text-secondary-color, #b0b3b8);
  font-size: 0.95rem;
  margin: 0;
}

.stats-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  padding: 2rem;
  color: var(--text-secondary-color, #b0b3b8);
}

.loading-spinner {
  width: 20px;
  height: 20px;
  border: 2px solid var(--card-border, rgba(57, 59, 64, 0.18));
  border-top: 2px solid var(--primary-color, #18191a);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.stats-error {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
  padding: 2rem;
  color: var(--error-color, #f56565);
  text-align: center;
}

.error-icon {
  font-size: 2rem;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.stat-item {
  background: var(--secondary-color, #23272e);
  border: 1px solid var(--card-border, rgba(57, 59, 64, 0.18));
  border-radius: 12px;
  padding: 1.5rem;
  display: flex;
  align-items: center;
  gap: 1rem;
  transition: all 0.3s ease;
}

.stat-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
}

.stat-item.highlight {
  background: linear-gradient(135deg, var(--primary-color, #18191a) 0%, var(--primary-gradient-end, #232526) 100%);
  border-color: var(--primary-color, #18191a);
}

.stat-icon {
  font-size: 1.5rem;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--card-bg, #292c33);
  border-radius: 8px;
}

.stat-item.highlight .stat-icon {
  background: rgba(255, 255, 255, 0.1);
}

.stat-content {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.stat-value {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text-color, #f5f6fa);
}

.accuracy-rate {
  color: var(--success-color, #48bb78);
  font-size: 1.75rem;
}

.stat-label {
  font-size: 0.875rem;
  color: var(--text-secondary-color, #b0b3b8);
  font-weight: 500;
}

.stats-footer {
  text-align: center;
  padding-top: 1rem;
  border-top: 1px solid var(--card-border, rgba(57, 59, 64, 0.18));
}

.refresh-icon {
  margin-right: 0.5rem;
}

/* äº®è‰²ä¸»é¢˜é€‚é… */
:root.light-theme .global-stats-card {
  background: #ffffff;
  border-color: #e2e8f0;
}

:root.light-theme .stats-title {
  color: #1a202c;
}

:root.light-theme .stats-description {
  color: #4a5568;
}

:root.light-theme .stat-item {
  background: #f7fafc;
  border-color: #e2e8f0;
}

:root.light-theme .stat-item.highlight {
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  border-color: #3b82f6;
}

:root.light-theme .stat-icon {
  background: #ffffff;
}

:root.light-theme .stat-item.highlight .stat-icon {
  background: rgba(255, 255, 255, 0.2);
}

:root.light-theme .stat-value {
  color: #1a202c;
}

:root.light-theme .stat-label {
  color: #4a5568;
}

:root.light-theme .stats-footer {
  border-color: #e2e8f0;
}

:root.light-theme .stats-loading {
  color: #4a5568;
}

:root.light-theme .loading-spinner {
  border-color: #e2e8f0;
  border-top-color: #3b82f6;
}

@media (max-width: 768px) {
  .case-study-options {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }
  
  .case-study-header {
    padding: 1.5rem;
  }
  
  .case-study-title {
    font-size: 1.5rem;
  }
  
  .case-study-card {
    padding: 1.5rem;
  }
  
  .question-title {
    font-size: 1.125rem;
  }
  
  .option-actions {
    flex-direction: column;
    gap: 1rem;
  }
  
  .btn {
    width: 100%;
    padding: 1.5rem;
  }
  
  /* å…¨å±€ç»Ÿè®¡å¡ç‰‡ç§»åŠ¨ç«¯æ ·å¼ */
  .global-stats-card {
    padding: 1.5rem;
    margin-top: 2rem;
  }
  
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }
  
  .stat-item {
    padding: 1rem;
    flex-direction: column;
    text-align: center;
    gap: 0.5rem;
  }
  
  .stat-icon {
    width: 32px;
    height: 32px;
    font-size: 1.25rem;
  }
  
  .stat-value {
    font-size: 1.25rem;
  }
  
  .accuracy-rate {
    font-size: 1.5rem;
  }
  
  .stats-title {
    font-size: 1.25rem;
  }
}
</style>
