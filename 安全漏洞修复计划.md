# äººå·¥æ™ºèƒ½æ•™å­¦å¹³å° å®‰å…¨æ¼æ´ä¿®å¤è®¡åˆ’

## ğŸ“‹ ä¿®å¤è®¡åˆ’æ¦‚è¿°

**åˆ¶å®šæ—¥æœŸ**: 2025å¹´10æœˆ30æ—¥  
**ç›®æ ‡ç³»ç»Ÿ**: 222.204.4.108 (Ubuntu + Nginx 1.18.0 + MySQL 8.0.43)  
**å½“å‰é£é™©ç­‰çº§**: éå¸¸å±é™© (9.7/10.0)  
**ç›®æ ‡é£é™©ç­‰çº§**: å®‰å…¨ (â‰¤3.0/10.0)  
**é¢„è®¡ä¿®å¤å‘¨æœŸ**: 2-3å‘¨

---

## ğŸ¯ ä¿®å¤ä¼˜å…ˆçº§çŸ©é˜µ

| ä¼˜å…ˆçº§ | æ¼æ´æ•°é‡ | é£é™©ç­‰çº§ | ä¿®å¤æ—¶é™ | è´Ÿè´£äºº |
|--------|---------|---------|---------|--------|
| P0 (ç´§æ€¥) | 6ä¸ª | é«˜å± | 48å°æ—¶å†… | ç³»ç»Ÿç®¡ç†å‘˜ |
| P1 (é‡è¦) | 2ä¸ª | ä¸­å± | 1å‘¨å†… | ç³»ç»Ÿç®¡ç†å‘˜ + DBA |
| P2 (ä¸€èˆ¬) | 22ä¸ª | ä½å± | 2å‘¨å†… | è¿ç»´å›¢é˜Ÿ |
| P3 (å»ºè®®) | 7ä¸ª | ä¿¡æ¯çº§ | 3å‘¨å†… | è¿ç»´å›¢é˜Ÿ |

---

## ğŸš¨ P0çº§ä¿®å¤ä»»åŠ¡ (48å°æ—¶å†…å®Œæˆ)

### ä»»åŠ¡1: å‡çº§NginxæœåŠ¡å™¨

**é£é™©æè¿°**: å½“å‰Nginx 1.18.0å­˜åœ¨5ä¸ªé«˜å±æ¼æ´ï¼Œå¯å¯¼è‡´DoSæ”»å‡»ã€å†…å­˜æ³„éœ²ã€è¿›ç¨‹å´©æºƒç­‰ä¸¥é‡åæœã€‚

**å½±å“çš„CVEç¼–å·**:
- CVE-2023-44487 (HTTP/2 DoSæ”»å‡»)
- CVE-2022-41742 (ç¼“å†²åŒºé”™è¯¯)
- CVE-2022-41741 (å†…å­˜ç ´å)
- CVE-2021-23017 (DNSè§£æå™¨æ¼æ´)
- CVE-2021-3618 (ALPACAæ”»å‡»)

#### è¯¦ç»†æ‰§è¡Œæ­¥éª¤:

**æ­¥éª¤1.1: å¤‡ä»½å½“å‰é…ç½®**
```bash
# å¤‡ä»½Nginxé…ç½®æ–‡ä»¶
sudo cp -r /etc/nginx /etc/nginx.backup.$(date +%Y%m%d)

# å¤‡ä»½ç½‘ç«™æ–‡ä»¶
sudo tar -czf /backup/website_backup_$(date +%Y%m%d).tar.gz /var/www/html

# è®°å½•å½“å‰ç‰ˆæœ¬
nginx -v > /tmp/nginx_version_before.txt
```

**æ­¥éª¤1.2: æ£€æŸ¥å½“å‰Nginxé…ç½®**
```bash
# æµ‹è¯•å½“å‰é…ç½®æ˜¯å¦æœ‰æ•ˆ
sudo nginx -t

# æŸ¥çœ‹å½“å‰è¿è¡Œçš„ç«™ç‚¹
sudo nginx -T > /tmp/nginx_config_full.txt
```

**æ­¥éª¤1.3: å‡çº§Nginxåˆ°æœ€æ–°ç¨³å®šç‰ˆ**
```bash
# æ·»åŠ å®˜æ–¹Nginxä»“åº“
sudo add-apt-repository ppa:nginx/stable

# æ›´æ–°åŒ…åˆ—è¡¨
sudo apt update

# å‡çº§Nginx
sudo apt install --only-upgrade nginx

# ç›®æ ‡ç‰ˆæœ¬: nginx/1.26.x æˆ–æ›´é«˜
```

**æ­¥éª¤1.4: éªŒè¯å‡çº§ç»“æœ**
```bash
# æ£€æŸ¥ç‰ˆæœ¬
nginx -v

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯æœåŠ¡
sudo systemctl restart nginx

# éªŒè¯æœåŠ¡çŠ¶æ€
sudo systemctl status nginx
```

**æ­¥éª¤1.5: åŠŸèƒ½éªŒè¯**
```bash
# æµ‹è¯•ä¸»ç«™ç‚¹
curl -I http://222.204.4.108/

# æµ‹è¯•8082ç«¯å£ç«™ç‚¹
curl -I http://222.204.4.108:8082/

# æ£€æŸ¥é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

**å›æ»šæ–¹æ¡ˆ**:
```bash
# å¦‚æœå‡çº§å¤±è´¥ï¼Œå›æ»šåˆ°å¤‡ä»½ç‰ˆæœ¬
sudo apt install nginx=1.18.0-0ubuntu1

# æ¢å¤é…ç½®æ–‡ä»¶
sudo rm -rf /etc/nginx
sudo cp -r /etc/nginx.backup.YYYYMMDD /etc/nginx

# é‡å¯æœåŠ¡
sudo systemctl restart nginx
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… Nginxç‰ˆæœ¬ â‰¥ 1.26.0
- âœ… ä¸¤ä¸ªWebç«™ç‚¹å‡å¯æ­£å¸¸è®¿é—®
- âœ… æ— é”™è¯¯æ—¥å¿—äº§ç”Ÿ
- âœ… å“åº”æ—¶é—´æ— æ˜æ˜¾å¢åŠ 

---

### ä»»åŠ¡2: ä¿®å¤SSHæœåŠ¡DHEæ¼æ´

**é£é™©æè¿°**: CVE-2002-20001 - Diffie-Hellmanå¯†é’¥åå•†åè®®æ¼æ´ï¼Œå¯å¯¼è‡´èµ„æºè€—å°½æ”»å‡»ã€‚

#### è¯¦ç»†æ‰§è¡Œæ­¥éª¤:

**æ­¥éª¤2.1: æ›´æ–°OpenSSLåº“**
```bash
# æ›´æ–°ç³»ç»ŸåŠ å¯†åº“
sudo apt update
sudo apt upgrade openssl libssl-dev

# éªŒè¯OpenSSLç‰ˆæœ¬
openssl version
```

**æ­¥éª¤2.2: é…ç½®SSHç¦ç”¨DHE**
```bash
# å¤‡ä»½SSHé…ç½®
sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup.$(date +%Y%m%d)

# ç¼–è¾‘SSHé…ç½®æ–‡ä»¶
sudo nano /etc/ssh/sshd_config
```

**æ·»åŠ ä»¥ä¸‹é…ç½®**:
```
# ç¦ç”¨DHEï¼Œä½¿ç”¨æ›´å®‰å…¨çš„å¯†é’¥äº¤æ¢ç®—æ³•
KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521

# ä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr

# ä½¿ç”¨å¼ºMACç®—æ³•
MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512,hmac-sha2-256
```

**æ­¥éª¤2.3: éªŒè¯å’Œé‡å¯SSH**
```bash
# æµ‹è¯•SSHé…ç½®
sudo sshd -t

# é‡å¯SSHæœåŠ¡
sudo systemctl restart sshd

# éªŒè¯æœåŠ¡çŠ¶æ€
sudo systemctl status sshd
```

**æ­¥éª¤2.4: æµ‹è¯•SSHè¿æ¥**
```bash
# ä»å¦ä¸€å°æœºå™¨æµ‹è¯•SSHè¿æ¥
ssh -v user@222.204.4.108

# æ£€æŸ¥ä½¿ç”¨çš„å¯†é’¥äº¤æ¢ç®—æ³•ï¼ˆåº”è¯¥æ˜¯ECDHEï¼‰
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… OpenSSLå·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
- âœ… SSHé…ç½®å·²ç¦ç”¨DHE
- âœ… SSHè¿æ¥æ­£å¸¸
- âœ… ä½¿ç”¨ECDHEå¯†é’¥äº¤æ¢

---

## âš ï¸ P1çº§ä¿®å¤ä»»åŠ¡ (1å‘¨å†…å®Œæˆ)

### ä»»åŠ¡3: å‡çº§MySQLæœåŠ¡å™¨

**é£é™©æè¿°**: CVE-2024-21176 - MySQL Server 8.0.43å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œå¯å¯¼è‡´æœåŠ¡æŒ‚èµ·æˆ–å´©æºƒã€‚

#### è¯¦ç»†æ‰§è¡Œæ­¥éª¤:

**æ­¥éª¤3.1: æ•°æ®åº“å¤‡ä»½**
```bash
# å®Œæ•´å¤‡ä»½æ‰€æœ‰æ•°æ®åº“
sudo mysqldump --all-databases --single-transaction --quick --lock-tables=false \
  > /backup/mysql_full_backup_$(date +%Y%m%d).sql

# å¤‡ä»½MySQLé…ç½®
sudo cp -r /etc/mysql /etc/mysql.backup.$(date +%Y%m%d)

# è®°å½•å½“å‰ç‰ˆæœ¬
mysql --version > /tmp/mysql_version_before.txt
```

**æ­¥éª¤3.2: å‡çº§MySQL**
```bash
# æ›´æ–°åŒ…åˆ—è¡¨
sudo apt update

# å‡çº§MySQLåˆ°8.4.0æˆ–æ›´é«˜ç‰ˆæœ¬
sudo apt install --only-upgrade mysql-server mysql-client

# æˆ–è€…ä½¿ç”¨MySQLå®˜æ–¹ä»“åº“
wget https://dev.mysql.com/get/mysql-apt-config_0.8.29-1_all.deb
sudo dpkg -i mysql-apt-config_0.8.29-1_all.deb
sudo apt update
sudo apt install mysql-server
```

**æ­¥éª¤3.3: å‡çº§æ•°æ®åº“**
```bash
# è¿è¡ŒMySQLå‡çº§è„šæœ¬
sudo mysql_upgrade -u root -p

# é‡å¯MySQLæœåŠ¡
sudo systemctl restart mysql

# éªŒè¯æœåŠ¡çŠ¶æ€
sudo systemctl status mysql
```

**æ­¥éª¤3.4: åŠŸèƒ½éªŒè¯**
```bash
# æ£€æŸ¥MySQLç‰ˆæœ¬
mysql --version

# ç™»å½•MySQLæµ‹è¯•
sudo mysql -u root -p

# åœ¨MySQLä¸­æ‰§è¡Œ
SHOW DATABASES;
SELECT VERSION();

# æµ‹è¯•æ•™å­¦å¹³å°çš„æ•°æ®åº“è¿æ¥
# (éœ€è¦å¯åŠ¨æ•™å­¦å¹³å°åº”ç”¨å¹¶æµ‹è¯•åŠŸèƒ½)
```

**å›æ»šæ–¹æ¡ˆ**:
```bash
# å¦‚æœå‡çº§å¤±è´¥ï¼Œæ¢å¤æ•°æ®åº“
sudo mysql -u root -p < /backup/mysql_full_backup_YYYYMMDD.sql

# é™çº§MySQLç‰ˆæœ¬ï¼ˆä¸æ¨èï¼Œä»…ä½œå¤‡ç”¨ï¼‰
sudo apt install mysql-server=8.0.43-*
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… MySQLç‰ˆæœ¬ â‰¥ 8.4.0
- âœ… æ‰€æœ‰æ•°æ®åº“å®Œæ•´æ— æŸ
- âœ… æ•™å­¦å¹³å°åº”ç”¨æ­£å¸¸è¿æ¥æ•°æ®åº“
- âœ… æŸ¥è¯¢æ€§èƒ½æ— æ˜æ˜¾ä¸‹é™

---

### ä»»åŠ¡4: é…ç½®NginxåŸŸåè®¿é—®é™åˆ¶

**é£é™©æè¿°**: æœªå¯¹HTTPè¯·æ±‚çš„Hostå¤´è¿›è¡Œä¸¥æ ¼é™åˆ¶ï¼Œå¯èƒ½è¢«æ¶æ„åˆ©ç”¨ç»•è¿‡å®‰å…¨é˜²æŠ¤ã€‚

#### è¯¦ç»†æ‰§è¡Œæ­¥éª¤:

**æ­¥éª¤4.1: ä¿®æ”¹Nginxé…ç½®æ–‡ä»¶**
```bash
# ç¼–è¾‘ä¸»ç«™ç‚¹é…ç½®
sudo nano /etc/nginx/sites-available/default
```

**æ·»åŠ ä»¥ä¸‹é…ç½®**:
```nginx
# å®šä¹‰é»˜è®¤serverå—ï¼Œæ‹’ç»æ‰€æœ‰æœªæ˜ç¡®ç»‘å®šçš„è¯·æ±‚
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;
    return 444;  # å…³é—­è¿æ¥ï¼Œä¸è¿”å›å“åº”
}

# ä¸»ç«™ç‚¹ - æ˜ç¡®æŒ‡å®šserver_name
server {
    listen 80;
    server_name 222.204.4.108 ai-course.yourdomain.com;
    
    root /var/www/html;
    index index.html index.htm;
    
    # æ‹’ç»éæ³•çš„Hostå¤´
    if ($host !~* ^(222\.204\.4\.108|ai-course\.yourdomain\.com)$ ) {
        return 403;
    }
    
    location / {
        try_files $uri $uri/ =404;
    }
}

# 8082ç«¯å£ç«™ç‚¹
server {
    listen 8082;
    server_name 222.204.4.108 ai-admin.yourdomain.com;
    
    # æ‹’ç»éæ³•çš„Hostå¤´
    if ($host !~* ^(222\.204\.4\.108:8082|ai-admin\.yourdomain\.com)$ ) {
        return 403;
    }
    
    # ... å…¶ä»–é…ç½®
}
```

**æ­¥éª¤4.2: æµ‹è¯•å’Œåº”ç”¨é…ç½®**
```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡è½½é…ç½®
sudo systemctl reload nginx
```

**æ­¥éª¤4.3: éªŒè¯é…ç½®**
```bash
# æµ‹è¯•æ­£å¸¸è®¿é—®
curl -I http://222.204.4.108/

# æµ‹è¯•æ¶æ„Hostå¤´ï¼ˆåº”è¯¥è¿”å›403æˆ–444ï¼‰
curl -H "Host: evilhost_test" http://222.204.4.108/

# æµ‹è¯•8082ç«¯å£
curl -H "Host: evilhost_test" http://222.204.4.108:8082/
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ­£å¸¸åŸŸå/IPè®¿é—®æ­£å¸¸
- âœ… æ¶æ„Hostå¤´è¢«æ‹’ç»
- âœ… è¿”å›403æˆ–444çŠ¶æ€ç 

---

## ğŸ“ P2çº§ä¿®å¤ä»»åŠ¡ (2å‘¨å†…å®Œæˆ)

### ä»»åŠ¡5: æ·»åŠ HTTPå®‰å…¨å“åº”å¤´

**é£é™©æè¿°**: ç¼ºå°‘å…³é”®çš„HTTPå®‰å…¨å“åº”å¤´ï¼Œå­˜åœ¨ç‚¹å‡»åŠ«æŒã€XSSã€ä¸­é—´äººæ”»å‡»ç­‰é£é™©ã€‚

#### è¯¦ç»†æ‰§è¡Œæ­¥éª¤:

**æ­¥éª¤5.1: åˆ›å»ºå®‰å…¨å¤´é…ç½®æ–‡ä»¶**
```bash
# åˆ›å»ºé€šç”¨å®‰å…¨å¤´é…ç½®
sudo nano /etc/nginx/snippets/security-headers.conf
```

**æ·»åŠ ä»¥ä¸‹å†…å®¹**:
```nginx
# å®‰å…¨å“åº”å¤´é…ç½®

# é˜²æ­¢ç‚¹å‡»åŠ«æŒæ”»å‡»
add_header X-Frame-Options "SAMEORIGIN" always;

# å†…å®¹å®‰å…¨ç­–ç•¥
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self'; frame-ancestors 'self';" always;

# å¼ºåˆ¶HTTPSï¼ˆå¦‚æœå¯ç”¨äº†HTTPSï¼‰
# add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# é˜²æ­¢MIMEç±»å‹å—…æ¢
add_header X-Content-Type-Options "nosniff" always;

# XSSä¿æŠ¤
add_header X-XSS-Protection "1; mode=block" always;

# æ§åˆ¶ä¸‹è½½é€‰é¡¹
add_header X-Download-Options "noopen" always;

# è·¨åŸŸç­–ç•¥
add_header X-Permitted-Cross-Domain-Policies "none" always;

# Referrerç­–ç•¥
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# æƒé™ç­–ç•¥
add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;
```

**æ­¥éª¤5.2: åœ¨ç«™ç‚¹é…ç½®ä¸­å¼•ç”¨**
```bash
# ç¼–è¾‘ä¸»ç«™ç‚¹é…ç½®
sudo nano /etc/nginx/sites-available/default
```

**åœ¨æ¯ä¸ªserverå—ä¸­æ·»åŠ **:
```nginx
server {
    listen 80;
    server_name 222.204.4.108;
    
    # å¼•å…¥å®‰å…¨å¤´é…ç½®
    include snippets/security-headers.conf;
    
    # ... å…¶ä»–é…ç½®
}
```

**æ­¥éª¤5.3: åº”ç”¨é…ç½®**
```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡è½½Nginx
sudo systemctl reload nginx
```

**æ­¥éª¤5.4: éªŒè¯å®‰å…¨å¤´**
```bash
# æ£€æŸ¥å“åº”å¤´
curl -I http://222.204.4.108/ | grep -E "X-Frame-Options|Content-Security-Policy|X-Content-Type-Options"

# ä½¿ç”¨åœ¨çº¿å·¥å…·éªŒè¯
# è®¿é—® https://securityheaders.com è¾“å…¥æ‚¨çš„URLè¿›è¡Œæ£€æµ‹
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰å¿…è¦çš„å®‰å…¨å“åº”å¤´å·²æ·»åŠ 
- âœ… SecurityHeaders.comè¯„åˆ† â‰¥ Açº§
- âœ… ç½‘ç«™åŠŸèƒ½æ­£å¸¸ï¼ˆCSPä¸å½±å“æ­£å¸¸åŠŸèƒ½ï¼‰

---

### ä»»åŠ¡6: ç¦ç”¨å±é™©çš„HTTPæ–¹æ³•

**é£é™©æè¿°**: 8082ç«¯å£å¯ç”¨äº†TRACEæ–¹æ³•ï¼Œå¯èƒ½å¯¼è‡´è·¨ç«™è¿½è¸ªæ”»å‡»ã€‚

#### è¯¦ç»†æ‰§è¡Œæ­¥éª¤:

**æ­¥éª¤6.1: ä¿®æ”¹Nginxé…ç½®**
```bash
# ç¼–è¾‘8082ç«¯å£ç«™ç‚¹é…ç½®
sudo nano /etc/nginx/sites-available/port8082
```

**æ·»åŠ ä»¥ä¸‹é…ç½®**:
```nginx
server {
    listen 8082;
    server_name 222.204.4.108;
    
    # ä»…å…è®¸å¿…è¦çš„HTTPæ–¹æ³•
    if ($request_method !~ ^(GET|POST|PUT|DELETE|HEAD|OPTIONS)$ ) {
        return 405;
    }
    
    # æˆ–è€…æ˜ç¡®æ‹’ç»å±é™©æ–¹æ³•
    location / {
        limit_except GET POST PUT DELETE HEAD OPTIONS {
            deny all;
        }
        # ... å…¶ä»–é…ç½®
    }
}
```

**æ­¥éª¤6.2: åº”ç”¨é…ç½®**
```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡è½½Nginx
sudo systemctl reload nginx
```

**æ­¥éª¤6.3: éªŒè¯é…ç½®**
```bash
# æµ‹è¯•TRACEæ–¹æ³•ï¼ˆåº”è¯¥è¿”å›405ï¼‰
curl -X TRACE http://222.204.4.108:8082/

# æµ‹è¯•TRACKæ–¹æ³•ï¼ˆåº”è¯¥è¿”å›405ï¼‰
curl -X TRACK http://222.204.4.108:8082/

# æµ‹è¯•æ­£å¸¸æ–¹æ³•ï¼ˆåº”è¯¥æ­£å¸¸å·¥ä½œï¼‰
curl -X GET http://222.204.4.108:8082/
curl -X POST http://222.204.4.108:8082/
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… TRACEå’ŒTRACKæ–¹æ³•è¢«ç¦ç”¨
- âœ… æ­£å¸¸HTTPæ–¹æ³•å·¥ä½œæ­£å¸¸
- âœ… è¿”å›405 Method Not Allowed

---

### ä»»åŠ¡7: éšè—æœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯

**é£é™©æè¿°**: æœåŠ¡å™¨æ³„éœ²è¯¦ç»†ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¾¿äºæ”»å‡»è€…é’ˆå¯¹æ€§æ”»å‡»ã€‚

#### è¯¦ç»†æ‰§è¡Œæ­¥éª¤:

**æ­¥éª¤7.1: ä¿®æ”¹Nginxä¸»é…ç½®**
```bash
# ç¼–è¾‘Nginxä¸»é…ç½®æ–‡ä»¶
sudo nano /etc/nginx/nginx.conf
```

**åœ¨httpå—ä¸­æ·»åŠ **:
```nginx
http {
    # éšè—Nginxç‰ˆæœ¬å·
    server_tokens off;
    
    # ä¿®æ”¹Serverå“åº”å¤´ï¼ˆå¯é€‰ï¼Œéœ€è¦ç¼–è¯‘æ—¶æ”¯æŒï¼‰
    # more_set_headers 'Server: WebServer';
    
    # ... å…¶ä»–é…ç½®
}
```

**æ­¥éª¤7.2: åº”ç”¨é…ç½®**
```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
```

**æ­¥éª¤7.3: éªŒè¯é…ç½®**
```bash
# æ£€æŸ¥å“åº”å¤´ï¼ˆä¸åº”è¯¥æ˜¾ç¤ºç‰ˆæœ¬å·ï¼‰
curl -I http://222.204.4.108/ | grep Server

# ä¹‹å‰: Server: nginx/1.18.0 (Ubuntu)
# ä¹‹å: Server: nginx
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… Serverå“åº”å¤´ä¸æ˜¾ç¤ºç‰ˆæœ¬å·
- âœ… æœåŠ¡æ­£å¸¸è¿è¡Œ

---

### ä»»åŠ¡8: åŠ å›ºæ–‡ä»¶å’Œç›®å½•æƒé™

**é£é™©æè¿°**: /images/ è·¯å¾„å¯èƒ½æ³„éœ²æ•æ„Ÿæ–‡ä»¶æˆ–å…è®¸ç›®å½•åˆ—è¡¨ã€‚

#### è¯¦ç»†æ‰§è¡Œæ­¥éª¤:

**æ­¥éª¤8.1: æ£€æŸ¥å½“å‰æƒé™**
```bash
# æ£€æŸ¥imagesç›®å½•
ls -la /var/www/html/images/

# æ£€æŸ¥Webæ ¹ç›®å½•æƒé™
ls -la /var/www/html/
```

**æ­¥éª¤8.2: ä¿®æ”¹Nginxé…ç½®ç¦ç”¨ç›®å½•åˆ—è¡¨**
```bash
# ç¼–è¾‘ç«™ç‚¹é…ç½®
sudo nano /etc/nginx/sites-available/default
```

**æ·»åŠ ä»¥ä¸‹é…ç½®**:
```nginx
server {
    # ... å…¶ä»–é…ç½®
    
    # ç¦ç”¨ç›®å½•åˆ—è¡¨
    autoindex off;
    
    location /images/ {
        # ç¦ç”¨ç›®å½•åˆ—è¡¨
        autoindex off;
        
        # ä»…å…è®¸è®¿é—®ç‰¹å®šæ–‡ä»¶ç±»å‹
        location ~ \.(jpg|jpeg|png|gif|svg|webp|ico)$ {
            try_files $uri =404;
        }
        
        # æ‹’ç»è®¿é—®å…¶ä»–æ–‡ä»¶ç±»å‹
        location ~ \.(php|sh|py|txt|log|bak|conf)$ {
            deny all;
        }
    }
}
```

**æ­¥éª¤8.3: è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™**
```bash
# è®¾ç½®Webæ ¹ç›®å½•æ‰€æœ‰æƒ
sudo chown -R www-data:www-data /var/www/html

# è®¾ç½®ç›®å½•æƒé™ï¼ˆ755: rwxr-xr-xï¼‰
sudo find /var/www/html -type d -exec chmod 755 {} \;

# è®¾ç½®æ–‡ä»¶æƒé™ï¼ˆ644: rw-r--r--ï¼‰
sudo find /var/www/html -type f -exec chmod 644 {} \;

# åˆ é™¤æ•æ„Ÿæ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
sudo find /var/www/html -name "*.bak" -delete
sudo find /var/www/html -name "*.log" -delete
sudo find /var/www/html -name ".git" -type d -exec rm -rf {} \; 2>/dev/null
```

**æ­¥éª¤8.4: åº”ç”¨é…ç½®**
```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡è½½Nginx
sudo systemctl reload nginx
```

**æ­¥éª¤8.5: éªŒè¯é…ç½®**
```bash
# æµ‹è¯•ç›®å½•åˆ—è¡¨ï¼ˆåº”è¯¥è¿”å›403æˆ–404ï¼‰
curl http://222.204.4.108/images/

# æµ‹è¯•æ­£å¸¸å›¾ç‰‡è®¿é—®ï¼ˆåº”è¯¥æ­£å¸¸ï¼‰
curl -I http://222.204.4.108/images/sample.jpg

# æµ‹è¯•æ•æ„Ÿæ–‡ä»¶è®¿é—®ï¼ˆåº”è¯¥è¿”å›403ï¼‰
curl http://222.204.4.108/images/config.php
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç›®å½•åˆ—è¡¨å·²ç¦ç”¨
- âœ… æ­£å¸¸å›¾ç‰‡å¯ä»¥è®¿é—®
- âœ… æ•æ„Ÿæ–‡ä»¶æ— æ³•è®¿é—®
- âœ… æ–‡ä»¶æƒé™æ­£ç¡®è®¾ç½®

---

## ğŸ“Š P3çº§ä¿®å¤ä»»åŠ¡ (3å‘¨å†…å®Œæˆ)

### ä»»åŠ¡9: å¯ç”¨HTTPSï¼ˆå¼ºçƒˆæ¨èï¼‰

**é£é™©æè¿°**: å½“å‰ä»…ä½¿ç”¨HTTPï¼Œå­˜åœ¨ä¸­é—´äººæ”»å‡»é£é™©ï¼Œæ— æ³•å¯ç”¨HSTSç­‰å®‰å…¨ç‰¹æ€§ã€‚

#### è¯¦ç»†æ‰§è¡Œæ­¥éª¤:

**æ­¥éª¤9.1: è·å–SSLè¯ä¹¦**
```bash
# å®‰è£…Certbot
sudo apt install certbot python3-certbot-nginx

# è·å–Let's Encryptå…è´¹è¯ä¹¦ï¼ˆéœ€è¦åŸŸåï¼‰
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com

# æˆ–è€…ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout /etc/ssl/private/nginx-selfsigned.key \
  -out /etc/ssl/certs/nginx-selfsigned.crt
```

**æ­¥éª¤9.2: é…ç½®Nginx HTTPS**
```bash
# ç¼–è¾‘ç«™ç‚¹é…ç½®
sudo nano /etc/nginx/sites-available/default
```

**æ·»åŠ HTTPS serverå—**:
```nginx
# HTTPé‡å®šå‘åˆ°HTTPS
server {
    listen 80;
    server_name 222.204.4.108;
    return 301 https://$server_name$request_uri;
}

# HTTPSé…ç½®
server {
    listen 443 ssl http2;
    server_name 222.204.4.108;
    
    # SSLè¯ä¹¦
    ssl_certificate /etc/ssl/certs/nginx-selfsigned.crt;
    ssl_certificate_key /etc/ssl/private/nginx-selfsigned.key;
    
    # SSLé…ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384';
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    
    # HSTS
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
    
    # å¼•å…¥å®‰å…¨å¤´é…ç½®
    include snippets/security-headers.conf;
    
    # ... å…¶ä»–é…ç½®
}
```

**æ­¥éª¤9.3: åº”ç”¨é…ç½®**
```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
```

**æ­¥éª¤9.4: éªŒè¯HTTPS**
```bash
# æµ‹è¯•HTTPSè®¿é—®
curl -I https://222.204.4.108/

# æµ‹è¯•HTTPé‡å®šå‘
curl -I http://222.204.4.108/

# ä½¿ç”¨åœ¨çº¿å·¥å…·æµ‹è¯•SSLé…ç½®
# è®¿é—® https://www.ssllabs.com/ssltest/
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… HTTPSæ­£å¸¸å·¥ä½œ
- âœ… HTTPè‡ªåŠ¨é‡å®šå‘åˆ°HTTPS
- âœ… SSL Labsè¯„åˆ† â‰¥ Açº§
- âœ… HSTSå·²å¯ç”¨

---

## ğŸ” ä¿®å¤åéªŒè¯æ¸…å•

### ç³»ç»Ÿçº§éªŒè¯

```bash
# 1. æ£€æŸ¥æ‰€æœ‰æœåŠ¡ç‰ˆæœ¬
nginx -v
mysql --version
openssl version
ssh -V

# 2. æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€
sudo systemctl status nginx
sudo systemctl status mysql
sudo systemctl status ssh

# 3. æ£€æŸ¥å¼€æ”¾ç«¯å£
sudo netstat -tlnp

# 4. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
sudo ufw status verbose
```

### Webå®‰å…¨éªŒè¯

```bash
# 1. ä½¿ç”¨åœ¨çº¿å·¥å…·æ‰«æ
# - SecurityHeaders.com (æ£€æŸ¥å®‰å…¨å“åº”å¤´)
# - SSLLabs.com (æ£€æŸ¥SSLé…ç½®)
# - Observatory.mozilla.org (ç»¼åˆå®‰å…¨è¯„ä¼°)

# 2. æ‰‹åŠ¨æµ‹è¯•
curl -I http://222.204.4.108/
curl -I http://222.204.4.108:8082/

# 3. æµ‹è¯•å±é™©æ–¹æ³•
curl -X TRACE http://222.204.4.108:8082/

# 4. æµ‹è¯•Hostå¤´
curl -H "Host: evilhost" http://222.204.4.108/
```

### åŠŸèƒ½éªŒè¯

- [ ] ä¸»ç«™ç‚¹ (http://222.204.4.108/) æ­£å¸¸è®¿é—®
- [ ] 8082ç«¯å£ç«™ç‚¹æ­£å¸¸è®¿é—®
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] SSHè¿œç¨‹ç™»å½•æ­£å¸¸
- [ ] æ‰€æœ‰æ•™å­¦å¹³å°åŠŸèƒ½æ­£å¸¸
- [ ] ç”¨æˆ·ç™»å½•/æ³¨å†ŒåŠŸèƒ½æ­£å¸¸
- [ ] æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½åŠŸèƒ½æ­£å¸¸

---

## ğŸ“ˆ è¿›åº¦è·Ÿè¸ªè¡¨

| ä»»åŠ¡ç¼–å· | ä»»åŠ¡åç§° | ä¼˜å…ˆçº§ | è®¡åˆ’å¼€å§‹ | è®¡åˆ’å®Œæˆ | å®é™…å®Œæˆ | è´Ÿè´£äºº | çŠ¶æ€ |
|---------|---------|-------|---------|---------|---------|--------|------|
| 1 | å‡çº§Nginx | P0 | Day 1 | Day 2 | | ç³»ç»Ÿç®¡ç†å‘˜ | å¾…å¼€å§‹ |
| 2 | ä¿®å¤SSH DHEæ¼æ´ | P0 | Day 1 | Day 2 | | ç³»ç»Ÿç®¡ç†å‘˜ | å¾…å¼€å§‹ |
| 3 | å‡çº§MySQL | P1 | Day 3 | Day 7 | | DBA | å¾…å¼€å§‹ |
| 4 | é…ç½®åŸŸåè®¿é—®é™åˆ¶ | P1 | Day 3 | Day 7 | | ç³»ç»Ÿç®¡ç†å‘˜ | å¾…å¼€å§‹ |
| 5 | æ·»åŠ HTTPå®‰å…¨å¤´ | P2 | Day 8 | Day 14 | | è¿ç»´å›¢é˜Ÿ | å¾…å¼€å§‹ |
| 6 | ç¦ç”¨å±é™©HTTPæ–¹æ³• | P2 | Day 8 | Day 14 | | è¿ç»´å›¢é˜Ÿ | å¾…å¼€å§‹ |
| 7 | éšè—æœåŠ¡å™¨ç‰ˆæœ¬ | P2 | Day 8 | Day 14 | | è¿ç»´å›¢é˜Ÿ | å¾…å¼€å§‹ |
| 8 | åŠ å›ºæ–‡ä»¶æƒé™ | P2 | Day 8 | Day 14 | | è¿ç»´å›¢é˜Ÿ | å¾…å¼€å§‹ |
| 9 | å¯ç”¨HTTPS | P3 | Day 15 | Day 21 | | è¿ç»´å›¢é˜Ÿ | å¾…å¼€å§‹ |

---

## ğŸš§ é£é™©ä¸åº”æ€¥é¢„æ¡ˆ

### é£é™©è¯†åˆ«

1. **æœåŠ¡ä¸­æ–­é£é™©**
   - å‡çº§è¿‡ç¨‹å¯èƒ½å¯¼è‡´çŸ­æ—¶é—´æœåŠ¡ä¸å¯ç”¨
   - ç¼“è§£æªæ–½: é€‰æ‹©ä½å³°æ—¶æ®µè¿›è¡Œï¼Œæå‰é€šçŸ¥ç”¨æˆ·

2. **é…ç½®é”™è¯¯é£é™©**
   - é…ç½®ä¿®æ”¹å¯èƒ½å¯¼è‡´æœåŠ¡å¼‚å¸¸
   - ç¼“è§£æªæ–½: å……åˆ†å¤‡ä»½ï¼Œæµ‹è¯•åå†åº”ç”¨

3. **æ•°æ®ä¸¢å¤±é£é™©**
   - MySQLå‡çº§å¯èƒ½å¯¼è‡´æ•°æ®é—®é¢˜
   - ç¼“è§£æªæ–½: å®Œæ•´å¤‡ä»½ï¼ŒéªŒè¯å¤‡ä»½å¯ç”¨æ€§

4. **å…¼å®¹æ€§é—®é¢˜**
   - æ–°ç‰ˆæœ¬å¯èƒ½ä¸ç°æœ‰åº”ç”¨ä¸å…¼å®¹
   - ç¼“è§£æªæ–½: åœ¨æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯

### åº”æ€¥è”ç³»æ–¹å¼

| è§’è‰² | å§“å | è”ç³»æ–¹å¼ | å¤‡æ³¨ |
|-----|------|---------|------|
| ç³»ç»Ÿç®¡ç†å‘˜ | | | è´Ÿè´£æœåŠ¡å™¨ç®¡ç† |
| DBA | | | è´Ÿè´£æ•°æ®åº“ç®¡ç† |
| å¼€å‘è´Ÿè´£äºº | | | è´Ÿè´£åº”ç”¨å±‚é—®é¢˜ |
| å®‰å…¨è´Ÿè´£äºº | | | è´Ÿè´£å®‰å…¨å†³ç­– |

### å›æ»šè®¡åˆ’

æ¯ä¸ªä»»åŠ¡éƒ½åŒ…å«è¯¦ç»†çš„å›æ»šæ­¥éª¤ï¼Œç¡®ä¿åœ¨å‡ºç°é—®é¢˜æ—¶èƒ½å¤Ÿå¿«é€Ÿæ¢å¤ã€‚

---

## ğŸ“š é™„å½•

### A. ç›¸å…³æ–‡æ¡£é“¾æ¥

- [Nginxå‡çº§æŒ‡å—](https://nginx.org/en/docs/)
- [MySQLå‡çº§æ–‡æ¡£](https://dev.mysql.com/doc/refman/8.0/en/upgrading.html)
- [OWASPå®‰å…¨é…ç½®æŒ‡å—](https://owasp.org/www-project-secure-headers/)
- [Let's Encryptè¯ä¹¦ç”³è¯·](https://letsencrypt.org/getting-started/)

### B. å®‰å…¨æ£€æµ‹å·¥å…·

- **SecurityHeaders.com** - HTTPå®‰å…¨å“åº”å¤´æ£€æµ‹
- **SSLLabs.com** - SSL/TLSé…ç½®æ£€æµ‹
- **Observatory.mozilla.org** - Mozillaå®‰å…¨è§‚æµ‹ç«™
- **Qualys** - ç»¼åˆæ¼æ´æ‰«æ
- **Nmap** - ç«¯å£å’ŒæœåŠ¡æ‰«æ
- **OWASP ZAP** - Webåº”ç”¨å®‰å…¨æµ‹è¯•

### C. ç›‘æ§å»ºè®®

è®¾ç½®ä»¥ä¸‹ç›‘æ§é¡¹ç›®:
- Nginxè®¿é—®æ—¥å¿—ç›‘æ§
- é”™è¯¯æ—¥å¿—ç›‘æ§
- æœåŠ¡å™¨CPU/å†…å­˜/ç£ç›˜ä½¿ç”¨ç‡
- å¼‚å¸¸æµé‡ç›‘æ§
- SSLè¯ä¹¦è¿‡æœŸæé†’
- æ•°æ®åº“æ€§èƒ½ç›‘æ§

### D. å®šæœŸç»´æŠ¤è®¡åˆ’

- **æ¯å‘¨**: æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—ï¼ŒæŸ¥çœ‹å¼‚å¸¸è®¿é—®
- **æ¯æœˆ**: æ›´æ–°ç³»ç»Ÿè¡¥ä¸ï¼Œæ‰«ææ–°æ¼æ´
- **æ¯å­£åº¦**: è¿›è¡Œå…¨é¢å®‰å…¨å®¡è®¡
- **æ¯å¹´**: æ›´æ–°SSLè¯ä¹¦ï¼Œé‡æ–°è¯„ä¼°å®‰å…¨ç­–ç•¥

---

## âœ… ç­¾ç½²ç¡®è®¤

| è§’è‰² | å§“å | ç­¾å | æ—¥æœŸ |
|-----|------|------|------|
| è®¡åˆ’åˆ¶å®šäºº | | | |
| ç³»ç»Ÿç®¡ç†å‘˜ | | | |
| æŠ€æœ¯è´Ÿè´£äºº | | | |
| å®‰å…¨è´Ÿè´£äºº | | | |

---

**ä¿®å¤è®¡åˆ’ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-30  
**ä¸‹æ¬¡å®¡æŸ¥**: ä¿®å¤å®Œæˆå


